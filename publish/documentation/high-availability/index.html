<!DOCTYPE html>
<!--

		 ______                           __                
		/\  _  \                         /\ \               
		\ \ \L\ \  _____      __      ___\ \ \___      __   
		 \ \  __ \/\ '__`\  /'__`\   /'___\ \  _ `\  /'__`\ 
		  \ \ \/\ \ \ \L\ \/\ \L\.\_/\ \__/\ \ \ \ \/\  __/ 
		   \ \_\ \_\ \ ,__/\ \__/.\_\ \____\\ \_\ \_\ \____\
		    \/_/\/_/\ \ \/  \/__/\/_/\/____/ \/_/\/_/\/____/
		             \ \_\                                  
		              \/_/                                  
                                                    
		       /'\_/`\                                      
		      /\      \     __    ____    ___     ____      
		      \ \ \__\ \  /'__`\ /',__\  / __`\  /',__\     
		       \ \ \_/\ \/\  __//\__, `\/\ \L\ \/\__, `\    
		        \ \_\\ \_\ \____\/\____/\ \____/\/\____/    
		         \/_/ \/_/\/____/\/___/  \/___/  \/___/     
		
-->
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
		    <meta name="viewport" content="width=device-width, initial-scale=1.0">
		    <meta name="description" content="">
		    <meta name="author" content="">

		    <!-- Le styles -->
		    <link href="../../assets/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css" />
		    <link href="../../assets/css/bootstrap-responsive.min.css" media="screen" rel="stylesheet" type="text/css" />
		    <link href="../../assets/css/main.css" media="screen" rel="stylesheet" type="text/css" />
		  
		    <!-- JS -->
		    <script src="../../assets/js/jquery-1.10.1.min.js" type="text/javascript"></script>
		    <script src="../../assets/js/bootstrap-dropdown.js" type="text/javascript"></script>
		
			<!-- Google Analytics Magic -->
			<script type="text/javascript">
			  var _gaq = _gaq || [];
			  _gaq.push(['_setAccount', 'UA-20226872-1']);
			  _gaq.push(['_setDomainName', 'apache.org']);
			  _gaq.push(['_trackPageview']);

			  (function() {
			    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			  })();
			</script>
    </head>
    <body>			
			<!-- navbar excitement -->
	    <div class="navbar navbar-static-top">
	      <div class="navbar-inner">
	        <div class="container">
						<a href="/" class="logo"><img src="/assets/img/mesos_logo.png" alt="Apache Mesos logo" /></a>
	          <ul class="nav">
	            <li><a href="/gettingstarted/">Getting Started</a></li>
	            <li><a href="/documentation/latest/">Documentation</a></li>
	            <li><a href="/downloads/">Downloads</a></li>
	            <li><a href="/community/">Community</a></li>
	          </ul>
	        </div>
	      </div>
	    </div><!-- /.navbar -->


      <div class="container">

			<!-- magical breadcrumbs -->
			<ul class="breadcrumb">
			  <li>
					<div class="dropdown">
					  <a class="dropdown-toggle" data-toggle="dropdown" href="#">Apache Software Foundation <b class="caret"></b></a>
					  <ul class="dropdown-menu" role="menu">
							<li><a href="http://www.apache.org">Apache Homepage</a></li>
							<li><a href="http://www.apache.org/licenses/">License</a></li>
					  	<li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>  
					  	<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
							<li><a href="http://www.apache.org/security/">Security</a></li>
					  </ul>
					</div>
				</li>
				<li><span class="divider">></span></li>
				<li><a href="http://mesos.apache.org">Apache Mesos</a></li>
				
			</ul><!-- /breadcrumb -->

			<div class="row-fluid">
	<div class="span4">
		<h4>If you're new to Mesos</h4>
		<p>See the <a href="/gettingstarted/">getting started</a> page for more information about downloading, building, and deploying Mesos.</p>
		
		<h4>If you'd like to get involved or you're looking for support</h4>
		<p>See our <a href="/community/">community</a> page for more details.</p>
	</div>
	<div class="span8">
		<h1>High Availability</h1>

<p>Mesos can run in high-availability mode, in which multiple Mesos masters run simultaneously. In this mode there is only one active master, and the others masters act as stand-by replacements. These non-active masters will take over if the active master fails.</p>

<p>Mesos uses Apache ZooKeeper in to coordinate the leader election of masters.</p>

<p>Running mesos in this mode requires ZooKeeper. Mesos is automatically built with an included ZooKeeper client library.</p>

<p>Leader election and detection in Mesos is done via ZooKeeper. See: http://zookeeper.apache.org/doc/trunk/recipes.html#sc_leaderElection for more information how ZooKeeper leader election works.</p>

<h2>Use</h2>

<p>First, a ZooKeeper cluster must be running, and a znode should be created for exclusive use by Mesos:</p>

<ul>
<li>Ensure the ZooKeeper cluster is up and running.</li>
<li>Create a znode for exclusive use by mesos. The znode path will need to be provided to all slaves / scheduler drivers.</li>
</ul>


<p>In order to spin up a Mesos cluster using multiple masters for fault-tolerance:</p>

<ul>
<li>Start the mesos-master binaries using the <code>--zk</code> flag, e.g. <code>--zk=zk://host1:port1/path,host2:port2/path,...</code></li>
<li>Start the mesos-slave binaries with <code>--master=zk://host1:port1/path,host2:port2/path,...</code></li>
<li>Start any framework schedulers using the same zk path, the SchedulerDriver must be constructed with this path.</li>
</ul>


<p>Refer to the Scheduler API for how to deal with leadership changes.</p>

<h2>Semantics</h2>

<p>The detector is implemented in the <code>src/detector</code> folder. In particular, we watch for several ZooKeeper session events:</p>

<ul>
<li>Connection</li>
<li>Reconnection</li>
<li>Session Expiration</li>
<li>ZNode creation, deletion, updates</li>
</ul>


<p>We also explicitly timeout our sessions, when disconnected from ZooKeeper for an amount of time, see: <code>ZOOKEEPER_SESSION_TIMEOUT</code>. This is because the ZooKeeper client libraries only notify of session expiration upon reconnection. These timeouts are of particular interest in the case of network partitions.</p>

<h2>Network Partitions</h2>

<p>When a network partition occurs, if a particular component is disconnected from ZooKeeper, the Master Detector of the partitioned component will induce a timeout event. This causes the component to be notified that there is no leading master.</p>

<p>When slaves are master-less, they ignore incoming messages from masters to ensure that we don&rsquo;t act on a non-leading master&rsquo;s decision.</p>

<p>When masters enter a leader-less state, they commit suicide.</p>

<p>The following semantics are enforced:</p>

<ul>
<li>If a slave is partitioned from the master, it will fail health-checks. The master will mark the slave as deactivated and send its tasks to LOST.</li>
<li>Deactivated slaves may not re-register with the master, and are instructed to shut down upon any further communication after deactivation.</li>
<li>When a slave is partitioned from ZooKeeper, it will enter a master-less state. It will ignore any master messages until a new master is elected.</li>
</ul>


	</div>
</div>

			
	      <hr>

				<!-- footer -->
	      <div class="footer">
	        <p>&copy; 2012-2013 <a href="http://apache.org">The Apache Software Foundation</a>.
	        Apache Mesos, the Apache feather logo, and the Apache Mesos project logo are trademarks of The Apache Software Foundation.<p>
	      </div><!-- /footer -->

	    </div> <!-- /container -->

    </body>
</html>
