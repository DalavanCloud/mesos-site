<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
		    <meta name="viewport" content="width=device-width, initial-scale=1.0">

		    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
		    <link rel="alternate" type="application/atom+xml" title="Apache Mesos Blog" href="/blog/feed.xml">
		    
		    <link href="../../../assets/css/main.css" media="screen" rel="stylesheet" type="text/css" />
				
		    
			
			<!-- Google Analytics Magic -->
			<script type="text/javascript">
			  var _gaq = _gaq || [];
			  _gaq.push(['_setAccount', 'UA-20226872-1']);
			  _gaq.push(['_setDomainName', 'apache.org']);
			  _gaq.push(['_trackPageview']);

			  (function() {
			    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			  })();
			</script>
    </head>
    <body>
			<!-- magical breadcrumbs -->
			<div class="topnav">
			<ul class="breadcrumb">
			  <li>
					<div class="dropdown">
					  <a data-toggle="dropdown" href="#">Apache Software Foundation <span class="caret"></span></a>
					  <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
							<li><a href="http://www.apache.org">Apache Homepage</a></li>
							<li><a href="http://www.apache.org/licenses/">License</a></li>
					  	<li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>  
					  	<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
							<li><a href="http://www.apache.org/security/">Security</a></li>
					  </ul>
					</div>
				</li>
				<li><a href="http://mesos.apache.org">Apache Mesos</a></li>
				
				
					<li><a href="/documentation
/">Documentation
</a></li>
				
				
			</ul><!-- /breadcrumb -->
			</div>
			
			<!-- navbar excitement -->
	    <div class="navbar navbar-static-top" role="navigation">
	      <div class="navbar-inner">
	        <div class="container">
						<a href="/" class="logo"><img src="/assets/img/mesos_logo.png" alt="Apache Mesos logo" /></a>
					<div class="nav-collapse">
						<ul class="nav nav-pills navbar-right">
						  <li><a href="/gettingstarted/">Getting Started</a></li>
						  <li><a href="/documentation/latest/">Documentation</a></li>
						  <li><a href="/downloads/">Downloads</a></li>
						  <li><a href="/community/">Community</a></li>
						</ul>
					</div>
	        </div>
	      </div>
	    </div><!-- /.navbar -->

      <div class="container">

			<div class="row-fluid">
	<div class="col-md-4">
		<h4>If you're new to Mesos</h4>
		<p>See the <a href="/gettingstarted/">getting started</a> page for more information about downloading, building, and deploying Mesos.</p>
		
		<h4>If you'd like to get involved or you're looking for support</h4>
		<p>See our <a href="/community/">community</a> page for more details.</p>
	</div>
	<div class="col-md-8">
		<h1>Persistent Volume</h1>

<p>Mesos provides a mechanism to create a persistent volume from disk
resources. When launching a task, you can create a volume that exists outside
the task&rsquo;s sandbox and will persist on the node even after the task dies or
completes. When the task exits, its resources &ndash; including the persistent volume
&ndash; can be offered back to the framework, so that the framework can launch the
same task again, launch a recovery task, or launch a new task that consumes the
previous task&rsquo;s output as its input. Persistent volumes enable stateful services
such as HDFS and Cassandra to store their data within Mesos rather than having
to resort to workarounds (e.g., writing task state to a distributed filesystem
that is mounted at a well-known location outside the task&rsquo;s sandbox).</p>

<p>Persistent volumes can only be created from <strong>reserved</strong> disk resources, whether
it be statically reserved or dynamically reserved. A dynamically reserved
persistent volume also cannot be unreserved without having explicitly destroyed
the volume. These rules exist to limit the accidental mistakes such as:
a persistent volume containing sensitive data being offered to other frameworks
in the cluster.</p>

<p>Please refer to the <a href="/documentation/latest/reservation/">Reservation</a> documentation for details
regarding reservation mechanisms available in Mesos.</p>

<p>Persistent volumes can be created by <strong>operators</strong> and authorized
<strong>frameworks</strong>. We require a <code>principal</code> from the operator or framework in order
to authenticate/authorize the operations. <a href="/documentation/latest/authorization/">Authorization</a> is
specified via the existing ACL mechanism. (<strong><em>Coming Soon</em></strong>)</p>

<ul>
<li><code>Offer::Operation::Create</code> and <code>Offer::Operation::Destroy</code> messages are
available for <strong>frameworks</strong> to send back via the <code>acceptOffers</code> API as a
response to a resource offer.</li>
<li><code>/create</code> and <code>/destroy</code> HTTP endpoints are available for <strong>operators</strong>
to manage persistent volumes through the master. (<strong><em>Coming Soon</em></strong>).</li>
</ul>


<p>In the following sections, we will walk through examples of each of the
interfaces described above.</p>

<h2><code>Offer::Operation::Create</code></h2>

<p>A framework is able to create volumes through the resource offer cycle.
Suppose we receive a resource offer with 2048 MB of dynamically reserved disk.</p>

<pre><code>{
  "id" : &lt;offer_id&gt;,
  "framework_id" : &lt;framework_id&gt;,
  "slave_id" : &lt;slave_id&gt;,
  "hostname" : &lt;hostname&gt;,
  "resources" : [
    {
      "name" : "disk",
      "type" : "SCALAR",
      "scalar" : { "value" : 2048 },
      "role" : &lt;framework_role&gt;,
      "reservation" : {
        "principal" : &lt;framework_principal&gt;
      }
    }
  ]
}
</code></pre>

<p>We can create a persistent volume from the 2048 MB of disk resources by sending
the following <code>Offer::Operation</code> message via the <code>acceptOffers</code> API.
<code>Offer::Operation::Create</code> has a <code>volumes</code> field which we specify with the
persistent volume information. We need to specify the following:</p>

<ol>
<li>ID of the persistent volume which needs to be unique per role on each slave.</li>
<li>The non-nested relative path within the container to mount the volume.</li>
<li>The permissions for the volume. Currently, <code>"RW"</code> is the only possible value.</li>
</ol>


<pre><code>{
  "type" : Offer::Operation::CREATE,
  "create": {
    "volumes" : [
      {
        "name" : "disk",
        "type" : "SCALAR",
        "scalar" : { "value" : 2048 },
        "role" : &lt;framework_role&gt;,
        "reservation" : {
          "principal" : &lt;framework_principal&gt;
        },
        "disk": {
          "persistence": {
            "id" : &lt;persistent_volume_id&gt;
          },
          "volume" : {
            "container_path" : &lt;container_path&gt;,
            "mode" : &lt;mode&gt;
          }
        }
      }
    ]
  }
}
</code></pre>

<p>The subsequent resource offer will <strong>contain</strong> the following persistent volume:</p>

<pre><code>{
  "id" : &lt;offer_id&gt;,
  "framework_id" : &lt;framework_id&gt;,
  "slave_id" : &lt;slave_id&gt;,
  "hostname" : &lt;hostname&gt;,
  "resources" : [
    {
      "name" : "disk",
      "type" : "SCALAR",
      "scalar" : { "value" : 2048 },
      "role" : &lt;framework_role&gt;,
      "reservation" : {
        "principal" : &lt;framework_principal&gt;
      },
      "disk": {
        "persistence": {
          "id" : &lt;persistent_volume_id&gt;
        },
        "volume" : {
          "container_path" : &lt;container_path&gt;,
          "mode" : &lt;mode&gt;
        }
      }
    }
  ]
}
</code></pre>

<h2><code>Offer::Operation::Destroy</code></h2>

<p>A framework is able to destroy persistent volumes through the resource offer
cycle. In <a href="#offeroperationcreate">Offer::Operation::Create</a>, we created a
persistent volume from 2048 MB of disk resources. Mesos will not garbage-collect
this volume until we explicitly destroy it. Suppose we would like to destroy the
volume we created. First, we receive a resource offer (copy/pasted from above):</p>

<pre><code>{
  "id" : &lt;offer_id&gt;,
  "framework_id" : &lt;framework_id&gt;,
  "slave_id" : &lt;slave_id&gt;,
  "hostname" : &lt;hostname&gt;,
  "resources" : [
    {
      "name" : "disk",
      "type" : "SCALAR",
      "scalar" : { "value" : 2048 },
      "role" : &lt;framework_role&gt;,
      "reservation" : {
        "principal" : &lt;framework_principal&gt;
      },
      "disk": {
        "persistence": {
          "id" : &lt;persistent_volume_id&gt;
        },
        "volume" : {
          "container_path" : &lt;container_path&gt;,
          "mode" : &lt;mode&gt;
        }
      }
    }
  ]
}
</code></pre>

<p>We destroy the persistent volume by sending the <code>Offer::Operation</code> message via
the <code>acceptOffers</code> API. <code>Offer::Operation::Destroy</code> has a <code>volumes</code> field which
we specify the persistent volumes to be destroyed.</p>

<pre><code>{
  "type" : Offer::Operation::DESTROY,
  "destroy" : {
    "volumes" : [
      {
        "name" : "disk",
        "type" : "SCALAR",
        "scalar" : { "value" : 2048 },
        "role" : &lt;framework_role&gt;,
        "reservation" : {
          "principal" : &lt;framework_principal&gt;
        },
        "disk": {
          "persistence": {
            "id" : &lt;persistent_volume_id&gt;
          },
          "volume" : {
            "container_path" : &lt;container_path&gt;,
            "mode" : &lt;mode&gt;
          }
        }
      }
    ]
  }
}
</code></pre>

<p>The persistent volume will be destroyed, but the disk resources will still be
reserved. As such, the subsequent resource offer will <strong>contain</strong> the following
reserved disk resources:</p>

<pre><code>{
  "id" : &lt;offer_id&gt;,
  "framework_id" : &lt;framework_id&gt;,
  "slave_id" : &lt;slave_id&gt;,
  "hostname" : &lt;hostname&gt;,
  "resources" : [
    {
      "name" : "disk",
      "type" : "SCALAR",
      "scalar" : { "value" : 2048 },
      "role" : &lt;framework_role&gt;,
      "reservation" : {
        "principal" : &lt;framework_principal&gt;
      }
    }
  ]
}
</code></pre>

<p>Note that in 0.23, even after you destroy the persistent volume, its content
will still be on the disk. The garbage collection for persistent volumes is
coming soon: <a href="https://issues.apache.org/jira/browse/MESOS-2408">MESOS-2408</a>.</p>

<h3><code>/create</code> (<em>Coming Soon</em>)</h3>

<h3><code>/destroy</code> (<em>Coming Soon</em>)</h3>

	</div>
</div>

			
	      <hr>

				<!-- footer -->
	      <div class="footer">
	        <p>&copy; 2012-2015 <a href="http://apache.org">The Apache Software Foundation</a>.
	        Apache Mesos, the Apache feather logo, and the Apache Mesos project logo are trademarks of The Apache Software Foundation.<p>
	      </div><!-- /footer -->

	    </div> <!-- /container -->

	    <!-- JS -->
	    <script src="//code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script>
			<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" type="text/javascript"></script>
    </body>
</html>
