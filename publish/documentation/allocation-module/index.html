<!DOCTYPE html>
<!--

		 ______                           __                
		/\  _  \                         /\ \               
		\ \ \L\ \  _____      __      ___\ \ \___      __   
		 \ \  __ \/\ '__`\  /'__`\   /'___\ \  _ `\  /'__`\ 
		  \ \ \/\ \ \ \L\ \/\ \L\.\_/\ \__/\ \ \ \ \/\  __/ 
		   \ \_\ \_\ \ ,__/\ \__/.\_\ \____\\ \_\ \_\ \____\
		    \/_/\/_/\ \ \/  \/__/\/_/\/____/ \/_/\/_/\/____/
		             \ \_\                                  
		              \/_/                                  
                                                    
		       /'\_/`\                                      
		      /\      \     __    ____    ___     ____      
		      \ \ \__\ \  /'__`\ /',__\  / __`\  /',__\     
		       \ \ \_/\ \/\  __//\__, `\/\ \L\ \/\__, `\    
		        \ \_\\ \_\ \____\/\____/\ \____/\/\____/    
		         \/_/ \/_/\/____/\/___/  \/___/  \/___/     

-->
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
		    <meta name="viewport" content="width=device-width, initial-scale=1.0">
		    <meta name="description" content="">
		    <meta name="author" content="">

		    <!-- Le styles -->
				<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
		    
		    <link href="../../assets/css/main.css" media="screen" rel="stylesheet" type="text/css" />
				
				
			
			<!-- Google Analytics Magic -->
			<script type="text/javascript">
			  var _gaq = _gaq || [];
			  _gaq.push(['_setAccount', 'UA-20226872-1']);
			  _gaq.push(['_setDomainName', 'apache.org']);
			  _gaq.push(['_trackPageview']);

			  (function() {
			    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			  })();
			</script>
    </head>
    <body>			
			<!-- navbar excitement -->
	    <div class="navbar navbar-static-top" role="navigation">
	      <div class="navbar-inner">
	        <div class="container">
						<a href="/" class="logo"><img src="/assets/img/mesos_logo.png" alt="Apache Mesos logo" /></a>
					<div class="nav-collapse">
						<ul class="nav nav-pills navbar-right">
						  <li><a href="/gettingstarted/">Getting Started</a></li>
						  <li><a href="/documentation/latest/">Documentation</a></li>
						  <li><a href="/downloads/">Downloads</a></li>
						  <li><a href="/community/">Community</a></li>
						</ul>
					</div>
	        </div>
	      </div>
	    </div><!-- /.navbar -->

      <div class="container">

			<!-- magical breadcrumbs -->
			<ul class="breadcrumb">
			  <li>
					<div class="dropdown">
					  <a class="dropdown-toggle" data-toggle="dropdown" href="#">Apache Software Foundation <b class="caret"></b></a>
					  <ul class="dropdown-menu" role="menu">
							<li><a href="http://www.apache.org">Apache Homepage</a></li>
							<li><a href="http://www.apache.org/licenses/">License</a></li>
					  	<li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>  
					  	<li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
							<li><a href="http://www.apache.org/security/">Security</a></li>
					  </ul>
					</div>
				</li>
				<li><a href="http://mesos.apache.org">Apache Mesos</a></li>
				
				
					<li><a href="/documentation
/">Documentation
</a></li>
				
				
			</ul><!-- /breadcrumb -->

			<div class="row-fluid">
	<div class="col-md-4">
		<h4>If you're new to Mesos</h4>
		<p>See the <a href="/gettingstarted/">getting started</a> page for more information about downloading, building, and deploying Mesos.</p>
		
		<h4>If you'd like to get involved or you're looking for support</h4>
		<p>See our <a href="/community/">community</a> page for more details.</p>
	</div>
	<div class="col-md-8">
		<h1>Mesos Allocation Module</h1>

<p>The logic that the Mesos master uses to determine which frameworks to make offer resource offers to is encapsulated in the Master&rsquo;s <em>allocation module</em>.  The allocation module is a pluggable component that organizations can use to implement their own sharing policy, e.g. fair-sharing, Dominant Resource Fairness (see <a href="http://www.eecs.berkeley.edu/Pubs/TechRpts/2010/EECS-2010-55.pdf">the DRF paper</a>), priority, etc.</p>

<h2>Allocation Module API</h2>

<p>Mesos is implemented in C++, so allocation modules are implemented in C++, and inherit the @AllocatorProcess@ class defined in @MESOS_HOME/src/master/allocator.hpp@. As of the time of this writing (5/29/13), the API for allocation modules is as follows:</p>

<pre><code>  virtual ~AllocatorProcess() {}

  virtual void initialize(
      const Flags&amp; flags,
      const process::PID&lt;Master&gt;&amp; master,
      const hashmap&lt;std::string, RoleInfo&gt;&amp; roles) = 0;

  virtual void frameworkAdded(
      const FrameworkID&amp; frameworkId,
      const FrameworkInfo&amp; frameworkInfo,
      const Resources&amp; used) = 0;

  virtual void frameworkRemoved(
      const FrameworkID&amp; frameworkId) = 0;

  virtual void frameworkActivated(
      const FrameworkID&amp; frameworkId,
      const FrameworkInfo&amp; frameworkInfo) = 0;

  virtual void frameworkDeactivated(
      const FrameworkID&amp; frameworkId) = 0;

  virtual void slaveAdded(
      const SlaveID&amp; slaveId,
      const SlaveInfo&amp; slaveInfo,
      const hashmap&lt;FrameworkID, Resources&gt;&amp; used) = 0;

  virtual void slaveRemoved(
      const SlaveID&amp; slaveId) = 0;

  virtual void updateWhitelist(
      const Option&lt;hashset&lt;std::string&gt; &gt;&amp; whitelist) = 0;

  virtual void resourcesRequested(
      const FrameworkID&amp; frameworkId,
      const std::vector&lt;Request&gt;&amp; requests) = 0;

  // Whenever resources offered to a framework go unused (e.g.,
  // refused) the master invokes this callback.
  virtual void resourcesUnused(
      const FrameworkID&amp; frameworkId,
      const SlaveID&amp; slaveId,
      const Resources&amp; resources,
      const Option&lt;Filters&gt;&amp; filters) = 0;

  // Whenever resources are "recovered" in the cluster (e.g., a task
  // finishes, an offer is removed because a framework has failed or
  // is failing over) the master invokes this callback.
  virtual void resourcesRecovered(
      const FrameworkID&amp; frameworkId,
      const SlaveID&amp; slaveId,
      const Resources&amp; resources) = 0;

  // Whenever a framework that has filtered resources wants to revive
  // offers for those resources the master invokes this callback.
  virtual void offersRevived(
      const FrameworkID&amp; frameworkId) = 0;
</code></pre>

<p>The default allocation module is the HierarchicalAllocatorProcess, which can be found in @MESOS_HOME/src/master/hierarchical_allocator_process.hpp@. You can reference this as a starting place if you choose to write your own allocation module.</p>

<h2>Sorter API</h2>

<p>Additionally, the hierarchical allocator module can be extended without the need to reimplement the entirety of the allocation logic through the use of the @Sorter@ abstraction.</p>

<p>Sorters define the order that roles or frameworks should be offered resources in by taking &ldquo;client&rdquo; objects and some information about those clients and returning an ordered list of clients.</p>

<p>Sorters are implemented in C++ and inherit the @Sorter@ class defined in @MESOS_HOME/src/master/sorter.hpp@. As of the time of this writing, the API for Sorters is as follows:</p>

<pre><code>  virtual ~Sorter() {}

  // Adds a client to allocate resources to. A client
  // may be a user or a framework.
  virtual void add(const std::string&amp; client, double weight = 1) = 0;

  // Removes a client.
  virtual void remove(const std::string&amp; client) = 0;

  // Readds a client to the sort after deactivate.
  virtual void activate(const std::string&amp; client) = 0;

  // Removes a client from the sort, so it won't get allocated to.
  virtual void deactivate(const std::string&amp; client) = 0;

  // Specify that resources have been allocated to the given client.
  virtual void allocated(const std::string&amp; client,
                         const Resources&amp; resources) = 0;

  // Specify that resources have been unallocated from the given client.
  virtual void unallocated(const std::string&amp; client,
                           const Resources&amp; resources) = 0;

  // Returns the resources that have been allocated to this client.
  virtual Resources allocation(const std::string&amp; client) = 0;

  // Add resources to the total pool of resources this
  // Sorter should consider.
  virtual void add(const Resources&amp; resources) = 0;

  // Remove resources from the total pool.
  virtual void remove(const Resources&amp; resources) = 0;

  // Returns a list of all clients, in the order that they
  // should be allocated to, according to this Sorter's policy.
  virtual std::list&lt;std::string&gt; sort() = 0;

  // Returns true if this Sorter contains the specified client,
  // either active or deactivated.
  virtual bool contains(const std::string&amp; client) = 0;

  // Returns the number of clients this Sorter contains,
  // either active or deactivated.
  virtual int count() = 0;
</code></pre>

<p>The default @Sorter@ is the DRFSorter, which implements fair sharing and can be found at @MESOS_HOME/src/master/drf_sorter.hpp@.</p>

<p>For DRF, if weights are specified in Sorter::add, a client&rsquo;s share will be divided by the weight, creating a form of priority. For example, a role that has a weight of 2 will be offered twice as many resources as a role with weight 1.</p>

	</div>
</div>

			
	      <hr>

				<!-- footer -->
	      <div class="footer">
	        <p>&copy; 2012-2013 <a href="http://apache.org">The Apache Software Foundation</a>.
	        Apache Mesos, the Apache feather logo, and the Apache Mesos project logo are trademarks of The Apache Software Foundation.<p>
	      </div><!-- /footer -->

	    </div> <!-- /container -->

	    <!-- JS -->
	    <script src="../../assets/js/jquery-1.10.1.min.js" type="text/javascript"></script>
	    <script src="../../assets/js/bootstrap.js" type="text/javascript"></script>
	    <script src="../../assets/js/bootstrap-dropdown.js" type="text/javascript"></script>
    </body>
</html>