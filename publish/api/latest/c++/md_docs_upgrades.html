<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: upgrades</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">upgrades </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>Upgrading Mesos</h1>
<p>This document serves as a guide for users who wish to upgrade an existing Mesos cluster. Some versions require particular upgrade techniques when upgrading a running cluster. Some upgrades will have incompatible changes.</p>
<h2>Upgrading from 0.26.x to 0.27.x</h2>
<ul>
<li>Mesos 0.27 introduces the concept of <em>implicit roles</em>. In previous releases, configuring roles required specifying a static whitelist of valid role names on master startup (via the <code>--roles</code> flag). In Mesos 0.27, if <code>--roles</code> is omitted, <em>any</em> role name can be used; controlling which principals are allowed to register as which roles should be done using <a class="el" href="authorization_8md.html">ACLs</a>. The role whitelist functionality is still supported but is deprecated.</li>
<li>The Allocator API has changed due to the introduction of implicit roles. Custom allocator implementations will need to be updated. See <a href="https://issues.apache.org/jira/browse/MESOS-4000">MESOS-4000</a> for more information.</li>
<li>The <code>executorLost</code> callback in the Scheduler interface will now be called whenever the slave detects termination of a custom executor. This callback was never called in previous versions, so please make sure any framework schedulers can now safely handle this callback. Note that this callback may not be reliably delivered.</li>
<li>The isolator <code>prepare</code> interface has been changed slightly. Instead of keeping adding parameters to the <code>prepare</code> interface, we decide to use a protobuf (<code>ContainerConfig</code>). Also, we renamed <code>ContainerPrepareInfo</code> to <code>ContainerLaunchInfo</code> to better capture the purpose of this struct. See <a href="https://issues.apache.org/jira/browse/MESOS-4240">MESOS-4240</a> and <a href="https://issues.apache.org/jira/browse/MESOS-4282">MESOS-4282</a> for more information. If you are an isolator module writer, you will have to adjust your isolator module according to the new interface and re-compile with 0.27.</li>
<li>ACLs.shutdown_frameworks has been deprecated in favor of the new ACLs.teardown_frameworks. This affects the <code>--acls</code> master flag for the local authorizer.</li>
<li>Reserved resources are now accounted for in the DRF role sorter. Previously unaccounted reservations will influence the weighted DRF sorter. If role weights were explicitly set, they may need to be adjusted in order to account for the reserved resources in the cluster.</li>
</ul>
<h2>Upgrading from 0.25.x to 0.26.x</h2>
<p><b>NOTE</b> The names of some TaskStatus::Reason enums have been changed. But the tag numbers remain unchanged, so it is backwards compatible. Frameworks using the new version might need to do some compile time adjustments:</p>
<ul>
<li>REASON_MEM_LIMIT -&gt; REASON_CONTAINER_LIMITATION_MEMORY</li>
<li>REASON_EXECUTOR_PREEMPTED -&gt; REASON_CONTAINER_PREEMPTED</li>
</ul>
<p><b>NOTE</b> The <code>Credential</code> protobuf has been changed. <code>Credential</code> field <code>secret</code> is now a string, it used to be bytes. This will affect framework developers and language bindings ought to update their generated protobuf with the new version. This fixes <a class="el" href="namespaceJSON.html">JSON</a> based credentials file support.</p>
<p><b>NOTE</b> The <code>/state</code> endpoints on master and slave will no longer include <code>data</code> fields as part of the <a class="el" href="namespaceJSON.html">JSON</a> models for <code>ExecutorInfo</code> and <code>TaskInfo</code> out of consideration for memory scalability (see <a href="https://issues.apache.org/jira/browse/MESOS-3794">MESOS-3794</a> and <a href="http://www.mail-archive.com/dev@mesos.apache.org/msg33536.html">this email thread</a>). On master, the affected <code>data</code> field was originally found via <code>frameworks[*].executors[*].data</code>. On slaves, the affected <code>data</code> field was originally found via <code>executors[*].tasks[*].data</code>.</p>
<p><b>NOTE</b> The <code>NetworkInfo</code> protobuf has been changed. The fields <code>protocol</code> and <code>ip_address</code> are now deprecated. The new field <code>ip_addresses</code> subsumes the information provided by them.</p>
<h2>Upgrading from 0.24.x to 0.25.x</h2>
<p><b>NOTE</b> The following endpoints will be deprecated in favor of new endpoints. Both versions will be available in 0.25 but the deprecated endpoints will be removed in a subsequent release.</p>
<p>For master endpoints:</p>
<ul>
<li>/state.json becomes /state</li>
<li>/tasks.json becomes /tasks</li>
</ul>
<p>For slave endpoints:</p>
<ul>
<li>/state.json becomes /state</li>
<li>/monitor/statistics.json becomes /monitor/statistics</li>
</ul>
<p>For both master and slave:</p>
<ul>
<li>/files/browse.json becomes /files/browse</li>
<li>/files/debug.json becomes /files/debug</li>
<li>/files/download.json becomes /files/download</li>
<li>/files/read.json becomes /files/read</li>
</ul>
<p><b>NOTE</b> The C++/Java/Python scheduler bindings have been updated. In particular, the driver can make a suppressOffers() call to stop receiving offers (until reviveOffers() is called).</p>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Rebuild and install any modules so that upgraded masters/slaves can use them.</li>
<li>Install the new master binaries and restart the masters.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the schedulers by linking the latest native library / jar / egg (if necessary).</li>
<li>Restart the schedulers.</li>
<li>Upgrade the executors by linking the latest native library / jar / egg (if necessary).</li>
</ul>
<h2>Upgrading from 0.23.x to 0.24.x</h2>
<p><b>NOTE</b> Support for live upgrading a driver based scheduler to HTTP based (experimental) scheduler has been added.</p>
<p><b>NOTE</b> Master now publishes its information in <a class="el" href="classZooKeeper.html">ZooKeeper</a> in <a class="el" href="namespaceJSON.html">JSON</a> (instead of protobuf). Make sure schedulers are linked against &gt;= 0.23.0 libmesos before upgrading the master.</p>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Rebuild and install any modules so that upgraded masters/slaves can use them.</li>
<li>Install the new master binaries and restart the masters.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the schedulers by linking the latest native library / jar / egg (if necessary).</li>
<li>Restart the schedulers.</li>
<li>Upgrade the executors by linking the latest native library / jar / egg (if necessary).</li>
</ul>
<h2>Upgrading from 0.22.x to 0.23.x</h2>
<p><b>NOTE</b> The 'stats.json' endpoints for masters and slaves have been removed. Please use the 'metrics/snapshot' endpoints instead.</p>
<p><b>NOTE</b> The '/master/shutdown' endpoint is deprecated in favor of the new '/master/teardown' endpoint.</p>
<p><b>NOTE</b> In order to enable decorator modules to remove metadata (environment variables or labels), we changed the meaning of the return value for decorator hooks in Mesos 0.23.0. Please refer to the modules documentation for more details.</p>
<p><b>NOTE</b> Slave ping timeouts are now configurable on the master via <code>--slave_ping_timeout</code> and <code>--max_slave_ping_timeouts</code>. Slaves should be upgraded to 0.23.x before changing these flags.</p>
<p><b>NOTE</b> A new scheduler driver API, <code>acceptOffers</code>, has been introduced. This is a more general version of the <code>launchTasks</code> API, which allows the scheduler to accept an offer and specify a list of operations (Offer.Operation) to perform using the resources in the offer. Currently, the supported operations include LAUNCH (launching tasks), RESERVE (making dynamic reservations), UNRESERVE (releasing dynamic reservations), CREATE (creating persistent volumes) and DESTROY (releasing persistent volumes). Similar to the <code>launchTasks</code> API, any unused resources will be considered declined, and the specified filters will be applied on all unused resources.</p>
<p><b>NOTE</b> The Resource protobuf has been extended to include more metadata for supporting persistence (DiskInfo), dynamic reservations (ReservationInfo) and oversubscription (RevocableInfo). You must not combine two Resource objects if they have different metadata.</p>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Rebuild and install any modules so that upgraded masters/slaves can use them.</li>
<li>Install the new master binaries and restart the masters.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the schedulers by linking the latest native library / jar / egg (if necessary).</li>
<li>Restart the schedulers.</li>
<li>Upgrade the executors by linking the latest native library / jar / egg (if necessary).</li>
</ul>
<h2>Upgrading from 0.21.x to 0.22.x</h2>
<p><b>NOTE</b> Slave checkpoint flag has been removed as it will be enabled for all slaves. Frameworks must still enable checkpointing during registration to take advantage of checkpointing their tasks.</p>
<p><b>NOTE</b> The stats.json endpoints for masters and slaves have been deprecated. Please refer to the metrics/snapshot endpoint.</p>
<p><b>NOTE</b> The C++/Java/Python scheduler bindings have been updated. In particular, the driver can be constructed with an additional argument that specifies whether to use implicit driver acknowledgements. In <code>statusUpdate</code>, the <code>TaskStatus</code> now includes a UUID to make explicit acknowledgements possible.</p>
<p><b>NOTE</b>: The Authentication API has changed slightly in this release to support additional authentication mechanisms. The change from 'string' to 'bytes' for AuthenticationStartMessage.data has no impact on C++ or the over-the-wire representation, so it only impacts pure language bindings for languages like Java and Python that use different types for UTF-8 strings vs. byte arrays. </p><pre class="fragment">message AuthenticationStartMessage {
  required string mechanism = 1;
  optional bytes data = 2;
}
</pre><p><b>NOTE</b> All Mesos arguments can now be passed using <a href="file://">file://</a> to read them out of a file (either an absolute or relative path). The &ndash;credentials, &ndash;whitelist, and any flags that expect <a class="el" href="namespaceJSON.html">JSON</a> backed arguments (such as &ndash;modules) behave as before, although support for just passing an absolute path for any <a class="el" href="namespaceJSON.html">JSON</a> flags rather than <a href="file://">file://</a> has been deprecated and will produce a warning (and the absolute path behavior will be removed in a future release).</p>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new master binaries and restart the masters.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the schedulers:<ul>
<li>For Java schedulers, link the new native library against the new JAR. The JAR contains API changes per the <b>NOTE</b> above. A 0.21.0 JAR will work with a 0.22.0 libmesos. A 0.22.0 JAR will work with a 0.21.0 libmesos if explicit acks are not being used. 0.22.0 and 0.21.0 are inter-operable at the protocol level between the master and the scheduler.</li>
<li>For Python schedulers, upgrade to use a 0.22.0 egg. If constructing <code>MesosSchedulerDriverImpl</code> with <code>Credentials</code>, your code must be updated to pass the <code>implicitAcknowledgements</code> argument before <code>Credentials</code>. You may run a 0.21.0 Python scheduler against a 0.22.0 master, and vice versa.</li>
</ul>
</li>
<li>Restart the schedulers.</li>
<li>Upgrade the executors by linking the latest native library / jar / egg.</li>
</ul>
<h2>Upgrading from 0.20.x to 0.21.x</h2>
<p><b>NOTE</b> Disabling slave checkpointing has been deprecated; the slave &ndash;checkpoint flag has been deprecated and will be removed in a future release.</p>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new master binaries and restart the masters.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the schedulers by linking the latest native library (mesos jar upgrade not necessary).</li>
<li>Restart the schedulers.</li>
<li>Upgrade the executors by linking the latest native library and mesos jar (if necessary).</li>
</ul>
<h2>Upgrading from 0.19.x to 0.20.x.</h2>
<p><b>NOTE</b>: The Mesos API has been changed slightly in this release. The CommandInfo has been changed (see below), which makes launching a command more flexible. The 'value' field has been changed from <em>required</em> to <em>optional</em>. However, it will not cause any issue during the upgrade (since the existing schedulers always set this field). </p><pre class="fragment">message CommandInfo {
  ...
  // There are two ways to specify the command:
  // 1) If 'shell == true', the command will be launched via shell
  //    (i.e., /bin/sh -c 'value'). The 'value' specified will be
  //    treated as the shell command. The 'arguments' will be ignored.
  // 2) If 'shell == false', the command will be launched by passing
  //    arguments to an executable. The 'value' specified will be
  //    treated as the filename of the executable. The 'arguments'
  //    will be treated as the arguments to the executable. This is
  //    similar to how POSIX exec families launch processes (i.e.,
  //    execlp(value, arguments(0), arguments(1), ...)).
  optional bool shell = 6 [default = true];
  optional string value = 3;
  repeated string arguments = 7;
  ...
}
</pre><p><b>NOTE</b>: The Python bindings are also changing in this release. There are now sub-modules which allow you to use either the interfaces and/or the native driver.</p>
<ul>
<li><code>import mesos.native</code> for the native drivers</li>
<li><code>import mesos.interface</code> for the stub implementations and protobufs</li>
</ul>
<p>To ensure a smooth upgrade, we recommend to upgrade your python framework and executor first. You will be able to either import using the new configuration or the old. Replace the existing imports with something like the following: </p><pre class="fragment">try:
    from mesos.native import MesosExecutorDriver, MesosSchedulerDriver
    from mesos.interface import Executor, Scheduler
    from mesos.interface import mesos_pb2
except ImportError:
    from mesos import Executor, MesosExecutorDriver, MesosSchedulerDriver, Scheduler
    import mesos_pb2
</pre><p><b>NOTE</b>: If you're using a pure language binding, please ensure that it sends status update acknowledgements through the master before upgrading.</p>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new master binaries and restart the masters.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the schedulers by linking the latest native library (install the latest mesos jar and python egg if necessary).</li>
<li>Restart the schedulers.</li>
<li>Upgrade the executors by linking the latest native library (install the latest mesos jar and python egg if necessary).</li>
</ul>
<h2>Upgrading from 0.18.x to 0.19.x.</h2>
<p><b>NOTE</b>: There are new required flags on the master (<code>--work_dir</code> and <code>--quorum</code>) to support the <em>Registrar</em> feature, which adds replicated state on the masters.</p>
<p><b>NOTE</b>: No required upgrade ordering across components.</p>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new master binaries and restart the masters.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the schedulers by linking the latest native library (mesos jar upgrade not necessary).</li>
<li>Restart the schedulers.</li>
<li>Upgrade the executors by linking the latest native library and mesos jar (if necessary).</li>
</ul>
<h2>Upgrading from 0.17.0 to 0.18.x.</h2>
<p>In order to upgrade a running cluster:</p>
<p><b>NOTE</b>: This upgrade requires a system reboot for slaves that use Linux cgroups for isolation.</p>
<ul>
<li>Install the new master binaries and restart the masters.</li>
<li>Upgrade the schedulers by linking the latest native library and mesos jar (if necessary).</li>
<li>Restart the schedulers.</li>
<li>Install the new slave binaries then perform one of the following two steps, depending on if cgroups isolation is used:<ul>
<li>[no cgroups]<ul>
<li>Restart the slaves. The "--isolation" flag has changed and "process" has been deprecated in favor of "posix/cpu,posix/mem".</li>
</ul>
</li>
<li>[cgroups]<ul>
<li>Change from a single mountpoint for all controllers to separate mountpoints for each controller, e.g., /sys/fs/cgroup/memory/ and /sys/fs/cgroup/cpu/.</li>
<li>The suggested configuration is to mount a tmpfs filesystem to /sys/fs/cgroup and to let the slave mount the required controllers. However, the slave will also use previously mounted controllers if they are appropriately mounted under "--cgroups_hierarchy".</li>
<li>It has been observed that unmounting and remounting of cgroups from the single to separate configuration is unreliable and a reboot into the new configuration is strongly advised. Restart the slaves after reboot.</li>
<li>The "--cgroups_hierarchy" now defaults to "/sys/fs/cgroup". The "--cgroups_root" flag default remains "mesos".</li>
<li>The "--isolation" flag has changed and "cgroups" has been deprecated in favor of "cgroups/cpu,cgroups/mem".</li>
<li>The "--cgroup_subsystems" flag is no longer required and will be ignored.</li>
</ul>
</li>
</ul>
</li>
<li>Upgrade the executors by linking the latest native library and mesos jar (if necessary).</li>
</ul>
<h2>Upgrading from 0.16.0 to 0.17.0.</h2>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new master binaries and restart the masters.</li>
<li>Upgrade the schedulers by linking the latest native library and mesos jar (if necessary).</li>
<li>Restart the schedulers.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the executors by linking the latest native library and mesos jar (if necessary).</li>
</ul>
<h2>Upgrading from 0.15.0 to 0.16.0.</h2>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new master binaries and restart the masters.</li>
<li>Upgrade the schedulers by linking the latest native library and mesos jar (if necessary).</li>
<li>Restart the schedulers.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the executors by linking the latest native library and mesos jar (if necessary).</li>
</ul>
<h2>Upgrading from 0.14.0 to 0.15.0.</h2>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new master binaries.</li>
<li>Restart the masters with &ndash;credentials pointing to credentials of the framework(s).</li>
<li>NOTE: &ndash;authentication=false (default) allows both authenticated and unauthenticated frameworks to register.</li>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Upgrade the executors by linking the latest native library and mesos jar (if necessary).</li>
<li>Upgrade the schedulers by linking the latest native library and mesos jar (if necessary).</li>
<li>NOTE: Schedulers should implement the new <code>reconcileTasks</code> driver method.</li>
<li>Schedulers should call the new <code>MesosSchedulerDriver</code> constructor that takes <code>Credential</code> to authenticate.</li>
<li>Restart the schedulers.</li>
<li>Restart the masters with &ndash;authentication=true.</li>
<li>NOTE: After the restart unauthenticated frameworks <em>will not</em> be allowed to register.</li>
</ul>
<h2>Upgrading from 0.13.0 to 0.14.0.</h2>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new master binaries and restart the masters.</li>
<li>NOTE: /vars endpoint has been removed.</li>
<li>Upgrade the executors by linking the latest native library and mesos jar (if necessary).</li>
<li>Install the new slave binaries.</li>
<li>Restart the slaves after adding &ndash;checkpoint flag to enable checkpointing.</li>
<li>NOTE: /vars endpoint has been removed.</li>
<li>Upgrade the schedulers by linking the latest native library and mesos jar (if necessary).</li>
<li><a class="el" href="classSet.html">Set</a> FrameworkInfo.checkpoint in the scheduler if checkpointing is desired (recommended).</li>
<li>Restart the schedulers.</li>
<li>Restart the masters (to get rid of the cached FrameworkInfo).</li>
<li>Restart the slaves (to get rid of the cached FrameworkInfo).</li>
</ul>
<h2>Upgrading from 0.12.0 to 0.13.0.</h2>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new master binaries and restart the masters.</li>
<li>Upgrade the schedulers by linking the latest native library and mesos jar (if necessary).</li>
<li>Restart the schedulers.</li>
<li>Install the new slave binaries.</li>
<li>NOTE: cgroups_hierarchy_root slave flag is renamed as cgroups_hierarchy</li>
<li>Restart the slaves.</li>
<li>Upgrade the executors by linking the latest native library and mesos jar (if necessary).</li>
</ul>
<h2>Upgrading from 0.11.0 to 0.12.0.</h2>
<p>In order to upgrade a running cluster:</p>
<ul>
<li>Install the new slave binaries and restart the slaves.</li>
<li>Install the new master binaries and restart the masters.</li>
</ul>
<p>If you are a framework developer, you will want to examine the new 'source' field in the ExecutorInfo protobuf. This will allow you to take further advantage of the resource monitoring. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
