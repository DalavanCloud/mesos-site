<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: executor-http-api</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">executor-http-api </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>Executor HTTP API</h1>
<p>Mesos 0.27.0 added <b>experimental</b> support for V1 Executor HTTP API.</p>
<h2>Overview</h2>
<p>The executor interacts with Mesos via "/api/v1/executor" endpoint hosted by the Mesos agent. The fully qualified URL of the endpoint might look like: </p><pre class="fragment">http://agenthost:5051/api/v1/executor
</pre><p>Note that we refer to this endpoint with its suffix "/executor" in the rest of this document. This endpoint accepts HTTP POST requests with data encoded as <a class="el" href="namespaceJSON.html">JSON</a> (Content-Type: application/json) or binary Protobuf (Content-Type: application/x-protobuf). The first request that the executor sends to "/executor" endpoint is called SUBSCRIBE and results in a streaming response ("200 OK" status code with Transfer-Encoding: chunked). <b>Executors are expected to keep the subscription connection open as long as possible (barring errors in network, agent process restarts, software bugs etc.) and incrementally process the response</b> (NOTE: HTTP client libraries that can only parse the response after the connection is closed cannot be used). For the encoding used, please refer to <b>Events</b> section below.</p>
<p>All the subsequent (non subscribe) requests to "/executor" endpoint (see details below in <b>Calls</b> section) must be sent using a different connection(s) than the one being used for subscription. Agent responds to these HTTP POST requests with "202 Accepted" status codes (or, for unsuccessful requests, with 4xx or 5xx status codes; details in later sections). The "202 Accepted" response means that a request has been accepted for processing, not that the processing of the request has been completed. The request might or might not be acted upon by Mesos (e.g., agent fails during the processing of the request). Any asynchronous responses from these requests will be streamed on the long-lived subscription connection.</p>
<h2>Calls</h2>
<p>The following calls are currently accepted by the agent. The canonical source of this information is <a href="https://github.com/apache/mesos/blob/master/include/mesos/v1/executor/executor.proto">executor.proto</a> (NOTE: The protobuf definitions are subject to change before the Beta API is finalized). Note that when sending <a class="el" href="namespaceJSON.html">JSON</a> encoded Calls, executors should encode raw bytes in Base64 and strings in UTF-8.</p>
<h3>SUBSCRIBE</h3>
<p>This is the first step in the communication process between the executor and agent. This is also to be considered as subscription to the "/executor" events stream.</p>
<p>To subscribe with the agent, the executor sends a HTTP POST request with encoded <code>SUBSCRIBE</code> message. The HTTP response is a stream with <a href="scheduler-http-api.md#recordio-response-format">RecordIO</a> encoding, with the first event being <code>SUBSCRIBED</code> event (see details in <b>Events</b> section).</p>
<p>Additionally, if the executor is connecting to the agent after a <a href="#disconnections">disconnection</a>, it can also send a list of:</p>
<ul>
<li><b>Unacknowledged Status Updates</b>: The executor is expected to maintain a list of status updates not acknowledged by the agent via the <code>ACKNOWLEDGE</code> events.</li>
<li><b>Unacknowledged Tasks</b>: The executor is expected to maintain a list of tasks that have not been acknowledged by the agent. A task is considered acknowledged if atleast one of the status updates for this task is acknowledged by the slave.</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;SUBSCRIBE Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;POST /api/v1/executor  HTTP/1.1</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Host: agenthost:5051</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Accept: application/json</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;type&quot;: &quot;SUBSCRIBE&quot;,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  &quot;executor_id&quot;: {</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &quot;value&quot;: &quot;387aa966-8fc5-4428-a794-5a868a60d3eb&quot;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  },</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  &quot;framework_id&quot;: {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    &quot;value&quot;: &quot;49154f1b-8cf6-4421-bf13-8bd11dccd1f1&quot;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  },</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  &quot;subscribe&quot;: {</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    &quot;unacknowledged_tasks&quot;: [</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      {</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        &quot;name&quot;: &quot;dummy-task&quot;,</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        &quot;task_id&quot;: {</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;          &quot;value&quot;: &quot;d40f3f3e-bbe3-44af-a230-4cb1eae72f67&quot;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        },</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        &quot;agent_id&quot;: {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;          &quot;value&quot;: &quot;f1c9cdc5-195e-41a7-a0d7-adaa9af07f81&quot;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        },</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        &quot;command&quot;: {</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;          &quot;value&quot;: &quot;ls&quot;,</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;          &quot;arguments&quot;: [</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;            &quot;-l&quot;,</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;            &quot;\/tmp&quot;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;          ]</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        }</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      }</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    ],</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    &quot;unacknowledged_updates&quot;: [</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        &quot;framework_id&quot;: {</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;          &quot;value&quot;: &quot;49154f1b-8cf6-4421-bf13-8bd11dccd1f1&quot;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        },</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        &quot;status&quot;: {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;          &quot;source&quot;: &quot;SOURCE_EXECUTOR&quot;,</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;          &quot;task_id&quot;: {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            &quot;value&quot;: &quot;d40f3f3e-bbe3-44af-a230-4cb1eae72f67&quot;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;          },</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        &quot;state&quot;: &quot;TASK_RUNNING&quot;,</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        &quot;uuid&quot;: &quot;ZDQwZjNmM2UtYmJlMy00NGFmLWEyMzAtNGNiMWVhZTcyZjY3Cg==&quot;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        }</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    ]</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  }</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;SUBSCRIBE Response Event (JSON):</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;HTTP/1.1 200 OK</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;Transfer-Encoding: chunked</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;{</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  &quot;type&quot;: &quot;SUBSCRIBED&quot;,</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  &quot;subscribed&quot;: {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    &quot;executor_info&quot;: {</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      &quot;executor_id&quot;: {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        &quot;value&quot;: &quot;387aa966-8fc5-4428-a794-5a868a60d3eb&quot;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      },</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      &quot;command&quot;: {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        &quot;value&quot;: &quot;\/path\/to\/executor&quot;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      },</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      &quot;framework_id&quot;: {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        &quot;value&quot;: &quot;49154f1b-8cf6-4421-bf13-8bd11dccd1f1&quot;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      }</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    },</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    &quot;framework_info&quot;: {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      &quot;user&quot;: &quot;foo&quot;,</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      &quot;name&quot;: &quot;my_framework&quot;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    },</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    &quot;agent_id&quot;: {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      &quot;value&quot;: &quot;f1c9cdc5-195e-41a7-a0d7-adaa9af07f81&quot;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    },</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    &quot;agent_info&quot;: {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      &quot;host&quot;: &quot;agenthost&quot;,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      &quot;port&quot;: 5051</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;&lt;more events&gt;</div></div><!-- fragment --><p>NOTE: Once an executor is launched, the agent waits for a duration of <code>--executor_registration_timeout</code> (configurable at agent startup) for the executor to subscribe. If the executor fails to subscribe within this duration, the agent forcefully destroys the container executor is running in.</p>
<h3>UPDATE</h3>
<p>Sent by the executor to reliably communicate the state of managed tasks. It is crucial that a terminal update (e.g., <code>TASK_FINISHED</code>, <code>TASK_KILLED</code> or <code>TASK_FAILED</code>) is sent to the agent as soon as the task terminates, in order to allow Mesos to release the resources allocated to the task.</p>
<p>The scheduler must explicitly respond to this call through an <code>ACKNOWLEDGE</code> message (see <code>ACKNOWLEDGED</code> in the Events section below for the semantics). The executor must maintain a list of unacknowledged updates. If for some reason, the executor is disconnected from the agent, these updates must be sent as part of <code>SUBSCRIBE</code> request in the <code>unacknowledged_updates</code> field.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;UPDATE Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;POST /api/v1/executor  HTTP/1.1</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Host: agenthost:5051</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Accept: application/json</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;executor_id&quot;: {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;value&quot;: &quot;387aa966-8fc5-4428-a794-5a868a60d3eb&quot;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &quot;framework_id&quot;: {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    &quot;value&quot;: &quot;9aaa9d0d-e00d-444f-bfbd-23dd197939a0-0000&quot;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  },</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  &quot;type&quot;: &quot;UPDATE&quot;,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  &quot;update&quot;: {</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    &quot;status&quot;: {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      &quot;executor_id&quot;: {</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        &quot;value&quot;: &quot;387aa966-8fc5-4428-a794-5a868a60d3eb&quot;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;      },</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      &quot;source&quot;: &quot;SOURCE_EXECUTOR&quot;,</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;      &quot;state&quot;: &quot;TASK_RUNNING&quot;,</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;      &quot;task_id&quot;: {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        &quot;value&quot;: &quot;66724cec-2609-4fa0-8d93-c5fb2099d0f8&quot;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      },</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;      &quot;uuid&quot;: &quot;ZDQwZjNmM2UtYmJlMy00NGFmLWEyMzAtNGNiMWVhZTcyZjY3Cg==&quot;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    }</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  }</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;}</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;UPDATE Response:</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>MESSAGE</h3>
<p>Sent by the executor to send arbitrary binary data to the scheduler. Note that Mesos neither interprets this data nor makes any guarantees about the delivery of this message to the scheduler. The <code>data</code> field is raw bytes encoded in Base64.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MESSAGE Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;POST /api/v1/executor  HTTP/1.1</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Host: agenthost:5051</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Accept: application/json</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;executor_id&quot;: {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;value&quot;: &quot;387aa966-8fc5-4428-a794-5a868a60d3eb&quot;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  &quot;framework_id&quot;: {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    &quot;value&quot;: &quot;9aaa9d0d-e00d-444f-bfbd-23dd197939a0-0000&quot;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  },</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  &quot;type&quot;: &quot;MESSAGE&quot;,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  &quot;data&quot;: &quot;t+Wonz5fRFKMzCnEptlv5A==&quot;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;}</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;MESSAGE Response:</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h2>Events</h2>
<p>Executor is expected to keep a <b>persistent</b> connection open to "/executor" endpoint even after getting a <code>SUBSCRIBED</code> HTTP Response event. This is indicated by "Connection: keep-alive" and "Transfer-Encoding: chunked" headers with <em>no</em> "Content-Length" header set. All subsequent events that are relevant to this executor generated by Mesos are streamed on this connection. Agent encodes each Event in <a href="scheduler-http-api.md#recordio-response-format">RecordIO</a> format, i.e., string representation of length of the event in bytes followed by <a class="el" href="namespaceJSON.html">JSON</a> or binary Protobuf (possibly compressed) encoded event. Note that the value of length will never be ‘0’ and the size of the length will be the size of unsigned integer (i.e., 64 bits). Also, note that the <code>RecordIO</code> encoding should be decoded by the executor whereas the underlying HTTP chunked encoding is typically invisible at the application (executor) layer. The type of content encoding used for the events will be determined by the accept header of the POST request (e.g., "Accept: application/json").</p>
<p>The following events are currently sent by the agent. The canonical source of this information is at <a href="include/mesos/v1/executor/executor.proto">executor.proto</a>. Note that when sending <a class="el" href="namespaceJSON.html">JSON</a> encoded events, agent encodes raw bytes in Base64 and strings in UTF-8.</p>
<h3>SUBSCRIBED</h3>
<p>The first event sent by the agent when the executor sends a <code>SUBSCRIBE</code> request on the persistent connection. See <code>SUBSCRIBE</code> in Calls section for the format.</p>
<h3>LAUNCH</h3>
<p>Sent by the agent whenever it needs to assign a new task to the executor. The executor is required to send an <code>UPDATE</code> message back to the agent indicating the success or failure of the task initialization.</p>
<p>The executor must maintain a list of unacknowledged tasks (see <code>SUBSCRIBE</code> in <code>Calls</code> section). If for some reason, the executor is disconnected from the agent, these tasks must be sent as part of <code>SUBSCRIBE</code> request in the <code>tasks</code> field.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;LAUNCH Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;type&quot;: &quot;LAUNCH&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;launch&quot;: {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;framework_info&quot;: {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;id&quot;: {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;value&quot;: &quot;49154f1b-8cf6-4421-bf13-8bd11dccd1f1&quot;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      },</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &quot;user&quot;: &quot;foo&quot;,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &quot;name&quot;: &quot;my_framework&quot;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    &quot;task&quot;: {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      &quot;name&quot;: &quot;dummy-task&quot;,</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;      &quot;task_id&quot;: {</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        &quot;value&quot;: &quot;d40f3f3e-bbe3-44af-a230-4cb1eae72f67&quot;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;      },</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      &quot;agent_id&quot;: {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        &quot;value&quot;: &quot;f1c9cdc5-195e-41a7-a0d7-adaa9af07f81&quot;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;      },</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;      &quot;command&quot;: {</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        &quot;value&quot;: &quot;sleep&quot;,</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        &quot;arguments&quot;: [</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;          &quot;100&quot;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        ]</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      }</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    }</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  }</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;}</div></div><!-- fragment --><h3>KILL</h3>
<p>The <code>KILL</code> event is sent whenever the scheduler needs to stop execution of a specific task. The executor is required to send a terminal update (e.g., <code>TASK_FINISHED</code>, <code>TASK_KILLED</code> or <code>TASK_FAILED</code>) back to the agent once it has stopped/killed the task. Mesos will mark the task resources as freed once the terminal update is received.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;LAUNCH Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;type&quot; : &quot;KILL&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;kill&quot; : {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;task_id&quot; : {&quot;value&quot; : &quot;d40f3f3e-bbe3-44af-a230-4cb1eae72f67&quot;}</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  }</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;}</div></div><!-- fragment --><h3>ACKNOWLEDGED</h3>
<p>Sent by the agent in order to signal the executor that a status update was received as part of the reliable message passing mechanism. Acknowledged updates must not be retried.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ACKNOWLEDGED Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;type&quot; : &quot;ACKNOWLEDGED&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;acknowledged&quot; : {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;task_id&quot; : {&quot;value&quot; : &quot;d40f3f3e-bbe3-44af-a230-4cb1eae72f67&quot;},</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &quot;uuid&quot; : &quot;ZDQwZjNmM2UtYmJlMy00NGFmLWEyMzAtNGNiMWVhZTcyZjY3Cg==&quot;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  }</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;}</div></div><!-- fragment --><h3>MESSAGE</h3>
<p>Custom message generated by the scheduler and forwarded all the way to the executor. These messages are delivered "as-is" by Mesos and have no delivery guarantees. It is up to the scheduler to retry if a message is dropped for any reason. Note that <code>data</code> is raw bytes encoded as Base64.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MESSAGE Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;type&quot; : &quot;MESSAGE&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;message&quot; : {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;data&quot; : &quot;c2FtcGxlIGRhdGE=&quot;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  }</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;}</div></div><!-- fragment --><h3>SHUTDOWN</h3>
<p>Sent by the agent in order to shutdown the executor. Once an executor gets a <code>SHUTDOWN</code> event it is required to kill all its tasks, send <code>TASK_KILLED</code> updates and gracefully exit. If an executor doesn't terminate within a certain period after the event was emitted (<code>grace_period_seconds</code>), the agent will forcefully destroy the container where the executor is running. The agent would then send <code>TASK_LOST</code> updates for any remaining active tasks of this executor.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;SHUTDOWN Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;type&quot; : &quot;SHUTDOWN&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;shutdown&quot; : {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;grace_period_seconds&quot; : 5</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  }</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;}</div></div><!-- fragment --><h3>ERROR</h3>
<p>Sent by the agent when an asynchronous error event is generated. It is recommended that the executor abort when it receives an error event and retry subscription.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ERROR Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;type&quot; : &quot;ERROR&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;error&quot; : {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;message&quot; : &quot;Unrecoverable error&quot;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  }</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;}</div></div><!-- fragment --><h2>Executor Environment Variables</h2>
<p>The following environment variables are set by the agent that can be used by the executor upon startup:</p>
<ul>
<li><code>MESOS_FRAMEWORK_ID</code>: <code>FrameworkID</code> of the scheduler needed as part of the <code>SUBSCRIBE</code> call.</li>
<li><code>MESOS_EXECUTOR_ID</code>: <code>ExecutorID</code> of the executor needed as part of the <code>SUBSCRIBE</code> call.</li>
<li><code>MESOS_DIRECTORY</code>: <a class="el" href="classPath.html" title="Represents a POSIX file systems path and offers common path manipulations. ">Path</a> to the working directory for the executor.</li>
<li><code>MESOS_AGENT_ENDPOINT</code>: Agent endpoint i.e. ip:port to be used by the executor to connect to the agent.</li>
<li><code>MESOS_CHECKPOINT</code>: If set to true, denotes that framework has checkpointing enabled.</li>
</ul>
<p>If <code>MESOS_CHECKPOINT</code> is set i.e. when framework checkpointing is enabled, the following additional variables are also set that can be used by the executor for retrying upon a disconnection with the agent:</p>
<ul>
<li><code>MESOS_RECOVERY_TIMEOUT</code>: The total duration that the executor should spend retrying before shutting itself down when it is disconnected from the agent (e.g., <code>15mins</code>, <code>5secs</code> etc.). This is configurable at agent startup via the flag <code>--recovery_timeout</code>.</li>
<li><code>MESOS_SUBSCRIPTION_BACKOFF_MAX</code>: The maximum backoff duration to be used by the executor between two retries when disconnected (e.g., <code>250ms</code>, <code>1mins</code> etc.). This is configurable at agent startup via the flag <code>--executor_reregistration_timeout</code>.</li>
</ul>
<p>NOTE: Additionally, the executor also inherits all the agent's environment variables.</p>
<h2>Disconnections</h2>
<p>An executor considers itself disconnected if the persistent subscription connection (opened via SUBSCRIBE request) to "/executor" breaks. The disconnection can happen due to an agent process failure etc.</p>
<p>Upon detecting a disconnection from the agent, the retry behavior depends on whether framework checkpointing is enabled:</p>
<ul>
<li>If framework checkpointing is disabled, the executor is not supposed to retry subscription and gracefully exit.</li>
<li>If framework checkpointing is enabled, the executor is supposed to retry subscription using a suitable <a href="#backoff-strategies">backoff strategy</a> for a duration of <code>MESOS_RECOVERY_TIMEOUT</code>. If it is not able to establish a subscription with the agent within this duration, it should gracefully exit.</li>
</ul>
<h2>Agent Recovery</h2>
<p>Upon agent startup, an agent performs <a class="el" href="slave-recovery_8md.html">recovery</a>. This allows the agent to recover status updates and reconnect with old executors. Currently, the agent supports the following recovery mechanisms specified via the <code>--recover</code> flag:</p>
<ul>
<li><b>reconnect</b> (default): This mode allows the agent to reconnect with any of it’s old live executors provided the framework has enabled checkpointing. The recovery of the agent is only marked complete once all the disconnected executors have connected and hung executors have been destroyed. Hence, it is mandatory that every executor retries at least once within the interval (<code>MESOS_SUBSCRIPTION_BACKOFF_MAX</code>) to ensure it is not shutdown by the agent due to being hung/unresponsive.</li>
<li><b>cleanup</b> : This mode kills any old live executors and then exits the agent. This is usually done by operators when making a non-compatible slave/executor upgrade. Upon receiving a <code>SUBSCRIBE</code> request from the executor of a framework with checkpointing enabled, the agent would send it a <code>SHUTDOWN</code> event as soon as it reconnects. For hung executors, the agent would wait for a duration of <code>--executor_shutdown_grace_period</code> (configurable at agent startup) and then forcefully kill the container where the executor is running in.</li>
</ul>
<h2>Backoff Strategies</h2>
<p>Executors are encouraged to retry subscription using a suitable backoff strategy like linear backoff, when they notice a disconnection with the agent. A disconnection typically happens when the agent process terminates (e.g., restarted for an upgrade). Each retry interval should be bounded by the value of <code>MESOS_SUBSCRIPTION_BACKOFF_MAX</code> which is set as an environment variable. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
