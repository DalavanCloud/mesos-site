<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: reservation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">reservation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>Reservation</h1>
<p>Mesos provides mechanisms to <b>reserve</b> resources in specific slaves. The concept was first introduced with <b>static reservation</b> in 0.14.0 which enabled operators to specify the reserved resources on slave startup. This was extended with <b>dynamic reservation</b> in 0.23.0 which enabled operators and authorized <b>frameworks</b> to dynamically reserve resources in the cluster.</p>
<p>In both types of reservations, resources are reserved for a <a class="el" href="roles_8md.html">__role__</a>.</p>
<h2>Static Reservation (since 0.14.0)</h2>
<p>An operator can configure a slave with resources reserved for a role. The reserved resources are specified via the <code>--resources</code> flag. For example, suppose we have 12 CPUs and 6144 MB of RAM available on a slave and that we want to reserve 8 CPUs and 4096 MB of RAM for the <code>ads</code> role. We start the slave like so: </p><pre class="fragment">    $ mesos-slave \
      --master=&lt;ip&gt;:&lt;port&gt; \
      --resources="cpus:4;mem:2048;cpus(ads):8;mem(ads):4096"
</pre><p>We now have 8 CPUs and 4096 MB of RAM reserved for <code>ads</code> on this slave.</p>
<p><b>CAVEAT:</b> In order to modify a static reservation, the operator must drain and restart the slave with the new configuration specified in the <code>--resources</code> flag.</p>
<p><b>NOTE:</b> This feature is supported for backwards compatibility. The recommended approach is to specify the total resources available on the slave as unreserved via the <code>--resources</code> flag and manage reservations dynamically via the master HTTP endpoints.</p>
<h2>Dynamic Reservation (since 0.23.0)</h2>
<p>As mentioned in <a href="#static-reservation-since-0140">Static Reservation</a>, specifying the reserved resources via the <code>--resources</code> flag makes the reservation static. This is, statically reserved resources cannot be reserved for another role nor be unreserved. Dynamic Reservation enables operators and authorized frameworks to reserve and unreserve resources post slave-startup.</p>
<p>We require a <code>principal</code> from the operator or framework in order to authenticate/authorize the operations. Permissions are specified via the existing ACL mechanism. To use authorization with reserve/unreserve operations, the Mesos master must be configured with the desired ACLs. For more information, see the <a class="el" href="authorization_8md.html">authorization documentation</a>.</p>
<ul>
<li><code>Offer::Operation::Reserve</code> and <code>Offer::Operation::Unreserve</code> messages are available for <b>frameworks</b> to send back via the <code>acceptOffers</code> API as a response to a resource offer.</li>
<li><code>/reserve</code> and <code>/unreserve</code> HTTP endpoints allow <b>operators</b> to manage dynamic reservations through the master. NOTE: As of 0.27.0, these endpoints cannot be used when HTTP authentication is disabled due to the current implementation. This will change in version 0.28.0.</li>
</ul>
<p>In the following sections, we will walk through examples of each of the interfaces described above.</p>
<p>Note that if two dynamic reservations are made for resources at a single slave, the reservations will be combined by adding together the resources reserved by each request. Similarly, "partial" unreserve operations are allowed: an unreserve operation can release only some of the resources at a slave that have been reserved for a given role. In this case, the unreserved resources will be subtracted from the previous reservation, and any remaining resources will still be reserved.</p>
<h3>Framework Scheduler API</h3>
<h4><code>Offer::Operation::Reserve</code></h4>
<p>A framework can reserve resources through the resource offer cycle. Suppose we receive a resource offer with 12 CPUs and 6144 MB of RAM unreserved. </p><pre class="fragment">    {
      "id": &lt;offer_id&gt;,
      "framework_id": &lt;framework_id&gt;,
      "slave_id": &lt;slave_id&gt;,
      "hostname": &lt;hostname&gt;,
      "resources": [
        {
          "name": "cpus",
          "type": "SCALAR",
          "scalar": { "value": 12 },
          "role": "*",
        },
        {
          "name": "mem",
          "type": "SCALAR",
          "scalar": { "value": 6144 },
          "role": "*",
        }
      ]
    }
</pre><p>We can reserve 8 CPUs and 4096 MB of RAM by sending the following <code>Offer::Operation</code> message. <code>Offer::Operation::Reserve</code> has a <code>resources</code> field which we specify with the resources to be reserved. We need to explicitly set the <code>role</code> and <code>principal</code> fields with the framework's role and principal. </p><pre class="fragment">    {
      "type": Offer::Operation::RESERVE,
      "reserve": {
        "resources": [
          {
            "name": "cpus",
            "type": "SCALAR",
            "scalar": { "value": 8 },
            "role": &lt;framework_role&gt;,
            "reservation": {
              "principal": &lt;framework_principal&gt;
            }
          },
          {
            "name": "mem",
            "type": "SCALAR",
            "scalar": { "value": 4096 },
            "role": &lt;framework_role&gt;,
            "reservation": {
              "principal": &lt;framework_principal&gt;
            }
          }
        ]
      }
    }
</pre><p>If the reservation is successful, a subsequent resource offer will contain the following reserved resources: </p><pre class="fragment">    {
      "id": &lt;offer_id&gt;,
      "framework_id": &lt;framework_id&gt;,
      "slave_id": &lt;slave_id&gt;,
      "hostname": &lt;hostname&gt;,
      "resources": [
        {
          "name": "cpus",
          "type": "SCALAR",
          "scalar": { "value": 8 },
          "role": &lt;framework_role&gt;,
          "reservation": {
            "principal": &lt;framework_principal&gt;
          }
        },
        {
          "name": "mem",
          "type": "SCALAR",
          "scalar": { "value": 4096 },
          "role": &lt;framework_role&gt;,
          "reservation": {
            "principal": &lt;framework_principal&gt;
          }
        },
      ]
    }
</pre><h4><code>Offer::Operation::Unreserve</code></h4>
<p>A framework can unreserve resources through the resource offer cycle. In <a href="#offeroperationreserve">Offer::Operation::Reserve</a>, we reserved 8 CPUs and 4096 MB of RAM on a particular slave for our <code>role</code>. The master will continue to only offer these resources to our <code>role</code>. Suppose we would like to unreserve these resources. First, we receive a resource offer (copy/pasted from above): </p><pre class="fragment">    {
      "id": &lt;offer_id&gt;,
      "framework_id": &lt;framework_id&gt;,
      "slave_id": &lt;slave_id&gt;,
      "hostname": &lt;hostname&gt;,
      "resources": [
        {
          "name": "cpus",
          "type": "SCALAR",
          "scalar": { "value": 8 },
          "role": &lt;framework_role&gt;,
          "reservation": {
            "principal": &lt;framework_principal&gt;
          }
        },
        {
          "name": "mem",
          "type": "SCALAR",
          "scalar": { "value": 4096 },
          "role": &lt;framework_role&gt;,
          "reservation": {
            "principal": &lt;framework_principal&gt;
          }
        },
      ]
    }
</pre><p>We can unreserve the 8 CPUs and 4096 MB of RAM by sending the following <code>Offer::Operation</code> message. <code>Offer::Operation::Unreserve</code> has a <code>resources</code> field which we can use to specify the resources to be unreserved. </p><pre class="fragment">    {
      "type": Offer::Operation::UNRESERVE,
      "unreserve": {
        "resources": [
          {
            "name": "cpus",
            "type": "SCALAR",
            "scalar": { "value": 8 },
            "role": &lt;framework_role&gt;,
            "reservation": {
              "principal": &lt;framework_principal&gt;
            }
          },
          {
            "name": "mem",
            "type": "SCALAR",
            "scalar": { "value": 4096 },
            "role": &lt;framework_role&gt;,
            "reservation": {
              "principal": &lt;framework_principal&gt;
            }
          }
        ]
      }
    }
</pre><p>The unreserved resources may now be offered to other frameworks.</p>
<h3>Operator HTTP Endpoints</h3>
<p>As described above, dynamic reservations can be made by a framework scheduler, typically in response to a resource offer. However, dynamic reservations can also be created and deleted by sending HTTP requests to the <code>/reserve</code> and <code>/unreserve</code> endpoints, respectively. This capability is intended for use by operators and administrative tools.</p>
<h4><code>/reserve</code> (since 0.25.0)</h4>
<p>Suppose we want to reserve 8 CPUs and 4096 MB of RAM for the <code>ads</code> role on a slave with id=<code>&lt;slave_id&gt;</code> (note that it is up to the user to find the ID of the slave that hosts the desired resources; the request will fail if sufficient unreserved resources cannot be found on the slave). We send an HTTP POST request to the <code>/reserve</code> HTTP endpoint like so: </p><pre class="fragment">    $ curl -i \
      -u &lt;operator_principal&gt;:&lt;password&gt; \
      -d slaveId=&lt;slave_id&gt; \
      -d resources='[
        {
          "name": "cpus",
          "type": "SCALAR",
          "scalar": { "value": 8 },
          "role": "ads",
          "reservation": {
            "principal": &lt;operator_principal&gt;
          }
        },
        {
          "name": "mem",
          "type": "SCALAR",
          "scalar": { "value": 4096 },
          "role": "ads",
          "reservation": {
            "principal": &lt;operator_principal&gt;
          }
        }
      ]' \
      -X POST http://&lt;ip&gt;:&lt;port&gt;/master/reserve
</pre><p>The user receives one of the following HTTP responses:</p>
<ul>
<li><code>200 OK</code>: Success (the requested resources have been reserved).</li>
<li><code>400 BadRequest</code>: Invalid arguments (e.g., missing parameters).</li>
<li><code>401 Unauthorized</code>: Unauthenticated request.</li>
<li><code>403 Forbidden</code>: Unauthorized request.</li>
<li><code>409 Conflict</code>: Insufficient resources to satisfy the reserve operation.</li>
</ul>
<h4><code>/unreserve</code> (since 0.25.0)</h4>
<p>Suppose we want to unreserve the resources that we dynamically reserved above. We can send an HTTP POST request to the <code>/unreserve</code> HTTP endpoint like so: </p><pre class="fragment">    $ curl -i \
      -u &lt;operator_principal&gt;:&lt;password&gt; \
      -d slaveId=&lt;slave_id&gt; \
      -d resources='[
        {
          "name": "cpus",
          "type": "SCALAR",
          "scalar": { "value": 8 },
          "role": "ads",
          "reservation": {
            "principal": &lt;operator_principal&gt;
          }
        },
        {
          "name": "mem",
          "type": "SCALAR",
          "scalar": { "value": 4096 },
          "role": "ads",
          "reservation": {
            "principal": &lt;operator_principal&gt;
          }
        }
      ]' \
      -X POST http://&lt;ip&gt;:&lt;port&gt;/master/unreserve
</pre><p>The user receives one of the following HTTP responses:</p>
<ul>
<li><code>200 OK</code>: Success (the requested resources have been unreserved).</li>
<li><code>400 BadRequest</code>: Invalid arguments (e.g., missing parameters).</li>
<li><code>401 Unauthorized</code>: Unauthenticated request.</li>
<li><code>403 Forbidden</code>: Unauthorized request.</li>
<li><code>409 Conflict</code>: Insufficient resources to satisfy the unreserve operation. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
