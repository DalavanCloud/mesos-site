<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: persistent-volume</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">persistent-volume </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>Persistent Volumes</h1>
<p>Mesos provides a mechanism to create a persistent volume from disk resources. When launching a task, you can create a volume that exists outside the task's sandbox and will persist on the node even after the task dies or completes. When the task exits, its resources &ndash; including the persistent volume &ndash; can be offered back to the framework, so that the framework can launch the same task again, launch a recovery task, or launch a new task that consumes the previous task's output as its input. Persistent volumes enable stateful services such as <a class="el" href="classHDFS.html">HDFS</a> and Cassandra to store their data within Mesos rather than having to resort to workarounds (e.g., writing task state to a distributed filesystem that is mounted at a well-known location outside the task's sandbox).</p>
<p>Persistent volumes can only be created from <b>reserved</b> disk resources, whether it be statically reserved or dynamically reserved. A dynamically reserved persistent volume also cannot be unreserved without first explicitly destroying the volume. These rules exist to limit accidental mistakes, such as a persistent volume containing sensitive data being offered to other frameworks in the cluster.</p>
<p>Please refer to the <a class="el" href="reservation_8md.html">Reservation</a> documentation for details regarding reservation mechanisms available in Mesos.</p>
<p>Persistent volumes can be created by <b>operators</b> and authorized <b>frameworks</b>. We require a <code>principal</code> from the operator or framework in order to authenticate/authorize the operations. Permissions are specified via the existing ACL mechanism. To use authorization with reserve, unreserve, create, and destroy operations, the Mesos master must be configured with the desired ACLs. For more information, see the <a class="el" href="authorization_8md.html">authorization documentation</a>.</p>
<ul>
<li><code>Offer::Operation::Create</code> and <code>Offer::Operation::Destroy</code> messages are available for <b>frameworks</b> to send back via the <code>acceptOffers</code> API as a response to a resource offer.</li>
<li><code>/create-volumes</code> and <code>/destroy-volumes</code> HTTP endpoints allow <b>operators</b> to manage persistent volumes through the master.</li>
</ul>
<p>In the following sections, we will walk through examples of each of the interfaces described above.</p>
<h3>Framework Scheduler API</h3>
<h4><code>Offer::Operation::Create</code></h4>
<p>A framework can create volumes through the resource offer cycle. Suppose we receive a resource offer with 2048 MB of dynamically reserved disk.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;id&quot; : &lt;offer_id&gt;,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &quot;framework_id&quot; : &lt;framework_id&gt;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;slave_id&quot; : &lt;slave_id&gt;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;hostname&quot; : &lt;hostname&gt;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;resources&quot; : [</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;name&quot; : &quot;disk&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &quot;type&quot; : &quot;SCALAR&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &quot;scalar&quot; : { &quot;value&quot; : 2048 },</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &quot;role&quot; : &lt;framework_role&gt;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      &quot;reservation&quot; : {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &quot;principal&quot; : &lt;framework_principal&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    }</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  ]</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;}</div></div><!-- fragment --><p>We can create a persistent volume from the 2048 MB of disk resources by sending an <code>Offer::Operation</code> message via the <code>acceptOffers</code> API. <code>Offer::Operation::Create</code> has a <code>volumes</code> field which specifies the persistent volume information. We need to specify the following:</p>
<ol type="1">
<li>The ID for the persistent volume; this must be unique per role on each slave.</li>
</ol>
<ol type="1">
<li>The non-nested relative path within the container to mount the volume.</li>
</ol>
<ol type="1">
<li>The permissions for the volume. Currently, <code>"RW"</code> is the only possible value.</li>
</ol>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;type&quot; : Offer::Operation::CREATE,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &quot;create&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &quot;volumes&quot; : [</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &quot;name&quot; : &quot;disk&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &quot;type&quot; : &quot;SCALAR&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;scalar&quot; : { &quot;value&quot; : 2048 },</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &quot;role&quot; : &lt;framework_role&gt;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        &quot;reservation&quot; : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;          &quot;principal&quot; : &lt;framework_principal&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &quot;disk&quot;: {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;          &quot;persistence&quot;: {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            &quot;id&quot; : &lt;persistent_volume_id&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;          },</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;          &quot;volume&quot; : {</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;            &quot;container_path&quot; : &lt;container_path&gt;,</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            &quot;mode&quot; : &lt;mode&gt;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;          }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        }</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    ]</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  }</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;}</div></div><!-- fragment --><p>If this succeeds, a subsequent resource offer will contain the following persistent volume:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;id&quot; : &lt;offer_id&gt;,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &quot;framework_id&quot; : &lt;framework_id&gt;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;slave_id&quot; : &lt;slave_id&gt;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;hostname&quot; : &lt;hostname&gt;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;resources&quot; : [</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;name&quot; : &quot;disk&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &quot;type&quot; : &quot;SCALAR&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &quot;scalar&quot; : { &quot;value&quot; : 2048 },</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &quot;role&quot; : &lt;framework_role&gt;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      &quot;reservation&quot; : {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &quot;principal&quot; : &lt;framework_principal&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      },</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;      &quot;disk&quot;: {</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        &quot;persistence&quot;: {</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;          &quot;id&quot; : &lt;persistent_volume_id&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        },</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        &quot;volume&quot; : {</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;          &quot;container_path&quot; : &lt;container_path&gt;,</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;          &quot;mode&quot; : &lt;mode&gt;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;      }</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    }</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  ]</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div></div><!-- fragment --><h4><code>Offer::Operation::Destroy</code></h4>
<p>A framework can destroy persistent volumes through the resource offer cycle. In <a href="#offeroperationcreate">Offer::Operation::Create</a>, we created a persistent volume from 2048 MB of disk resources. Mesos will not garbage-collect this volume until we explicitly destroy it. Suppose we would like to destroy the volume we created. First, we receive a resource offer (copy/pasted from above):</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;id&quot; : &lt;offer_id&gt;,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &quot;framework_id&quot; : &lt;framework_id&gt;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;slave_id&quot; : &lt;slave_id&gt;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;hostname&quot; : &lt;hostname&gt;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;resources&quot; : [</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;name&quot; : &quot;disk&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &quot;type&quot; : &quot;SCALAR&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &quot;scalar&quot; : { &quot;value&quot; : 2048 },</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &quot;role&quot; : &lt;framework_role&gt;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      &quot;reservation&quot; : {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &quot;principal&quot; : &lt;framework_principal&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      },</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;      &quot;disk&quot;: {</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        &quot;persistence&quot;: {</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;          &quot;id&quot; : &lt;persistent_volume_id&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        },</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        &quot;volume&quot; : {</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;          &quot;container_path&quot; : &lt;container_path&gt;,</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;          &quot;mode&quot; : &lt;mode&gt;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;      }</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    }</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  ]</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div></div><!-- fragment --><p>We destroy the persistent volume by sending the <code>Offer::Operation</code> message via the <code>acceptOffers</code> API. <code>Offer::Operation::Destroy</code> has a <code>volumes</code> field which specifies the persistent volumes to be destroyed.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;type&quot; : Offer::Operation::DESTROY,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &quot;destroy&quot; : {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &quot;volumes&quot; : [</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &quot;name&quot; : &quot;disk&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &quot;type&quot; : &quot;SCALAR&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;scalar&quot; : { &quot;value&quot; : 2048 },</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &quot;role&quot; : &lt;framework_role&gt;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        &quot;reservation&quot; : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;          &quot;principal&quot; : &lt;framework_principal&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &quot;disk&quot;: {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;          &quot;persistence&quot;: {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            &quot;id&quot; : &lt;persistent_volume_id&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;          },</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;          &quot;volume&quot; : {</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;            &quot;container_path&quot; : &lt;container_path&gt;,</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            &quot;mode&quot; : &lt;mode&gt;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;          }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        }</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    ]</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  }</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;}</div></div><!-- fragment --><p>If this request succeeds, the persistent volume will be destroyed but the disk resources will still be reserved. As such, a subsequent resource offer will contain the following reserved disk resources:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;id&quot; : &lt;offer_id&gt;,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &quot;framework_id&quot; : &lt;framework_id&gt;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;slave_id&quot; : &lt;slave_id&gt;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;hostname&quot; : &lt;hostname&gt;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;resources&quot; : [</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;name&quot; : &quot;disk&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &quot;type&quot; : &quot;SCALAR&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &quot;scalar&quot; : { &quot;value&quot; : 2048 },</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &quot;role&quot; : &lt;framework_role&gt;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      &quot;reservation&quot; : {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &quot;principal&quot; : &lt;framework_principal&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    }</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  ]</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;}</div></div><!-- fragment --><p>Those reserved resources can then be used as normal: e.g., they can be used to create another persistent volume or can be unreserved.</p>
<p>Garbage collection for persistent volumes is planned but has not been implemented yet &ndash; <a href="https://issues.apache.org/jira/browse/MESOS-2408">MESOS-2408</a>. In the mean time, even after you destroy a persistent volume, its content will remain on disk.</p>
<h3>Operator HTTP Endpoints</h3>
<p>As described above, persistent volumes can be created by a framework scheduler as part of the resource offer cycle. Persistent volumes can also be created and destroyed by sending HTTP requests to the <code>/create-volumes</code> and <code>/destroy-volumes</code> endpoints, respectively. This capability is intended for use by operators and administrative tools.</p>
<h4><code>/create-volumes</code></h4>
<p>To use this endpoint, the operator should first ensure that a reservation for the necessary resources has been made on the appropriate slave (e.g., by using the <code>/reserve</code> HTTP endpoint or by configuring a static reservation).</p>
<p>To create a 512MB persistent volume for the <code>ads</code> role on a dynamically reserved disk resource, we can send a request like so:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;curl -i \</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;     -u &lt;operator_principal&gt;:&lt;password&gt; \</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;     -d slaveId=&lt;slave_id&gt; \</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;     -d volumes=&#39;[</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;       {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;         &quot;name&quot;: &quot;disk&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;         &quot;type&quot;: &quot;SCALAR&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;         &quot;scalar&quot;: { &quot;value&quot;: 512 },</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;         &quot;role&quot;: &quot;ads&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;         &quot;reservation&quot;: {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;           &quot;principal&quot;: &lt;operator_principal&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;         },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;         &quot;disk&quot;: {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;           &quot;persistence&quot;: {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;             &quot;id&quot; : &lt;persistence_id&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;           },</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;           &quot;volume&quot;: {</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;             &quot;mode&quot;: &quot;RW&quot;,</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;             &quot;container_path&quot;: &lt;path&gt;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;           }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;         }</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;       }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;     ]&#39; \</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;     -X POST http://&lt;ip&gt;:&lt;port&gt;/master/create-volumes</div></div><!-- fragment --><p>The user receives one of the following HTTP responses:</p>
<ul>
<li><code>200 OK</code>: Success (the persistent volumes have been created).</li>
<li><code>400 BadRequest</code>: Invalid arguments (e.g., missing parameters).</li>
<li><code>401 Unauthorized</code>: Unauthenticated request.</li>
<li><code>403 Forbidden</code>: Unauthorized request.</li>
<li><code>409 Conflict</code>: Insufficient resources to create the volumes.</li>
</ul>
<p>Note that a single <code>/create-volumes</code> request can create multiple persistent volumes, but all of the volumes must be on the same slave.</p>
<h4><code>/destroy-volumes</code></h4>
<p>To destroy the volume created above, we can send an HTTP POST like so:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;curl -i \</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;     -u &lt;operator_principal&gt;:&lt;password&gt; \</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;     -d slaveId=&lt;slave_id&gt; \</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;     -d volumes=&#39;[</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;       {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;         &quot;name&quot;: &quot;disk&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;         &quot;type&quot;: &quot;SCALAR&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;         &quot;scalar&quot;: { &quot;value&quot;: 512 },</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;         &quot;role&quot;: &quot;ads&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;         &quot;reservation&quot;: {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;           &quot;principal&quot;: &lt;operator_principal&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;         },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;         &quot;disk&quot;: {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;           &quot;persistence&quot;: {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;             &quot;id&quot; : &lt;persistence_id&gt;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;           },</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;           &quot;volume&quot;: {</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;             &quot;mode&quot;: &quot;RW&quot;,</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;             &quot;container_path&quot;: &lt;path&gt;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;           }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;         }</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;       }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;     ]&#39; \</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;     -X POST http://&lt;ip&gt;:&lt;port&gt;/master/destroy-volumes</div></div><!-- fragment --><p>The user receives one of the following HTTP responses:</p>
<ul>
<li><code>200 OK</code>: Success (the volumes have been destroyed).</li>
<li><code>400 BadRequest</code>: Invalid arguments (e.g., missing parameters).</li>
<li><code>401 Unauthorized</code>: Unauthenticated request.</li>
<li><code>403 Forbidden</code>: Unauthorized request.</li>
<li><code>409 Conflict</code>: Insufficient resources to destroy the volumes.</li>
</ul>
<p>Note that a single <code>/destroy-volumes</code> request can destroy multiple persistent volumes, but all of the volumes must be on the same slave.</p>
<h3>Programming with Persistent Volumes</h3>
<p>Some suggestions to keep in mind when building applications that use persistent volumes:</p>
<ul>
<li>A single <code>acceptOffers</code> call can be used to both create a new dynamic reservation (via <code>Offer::Operation::Reserve</code>) and create a new persistent volume on those newly reserved resources (via <code>Offer::Operation::Create</code>).</li>
<li>Attempts to dynamically reserve resources or create persistent volumes might fail&mdash;for example, because the network message containing the operation did not reach the master or because the master rejected the operation. Applications should be prepared to detect failures and correct for them (e.g., by retrying the operation).</li>
<li>When using HTTP endpoints to reserve resources or create persistent volumes, <em>some</em> failures can be detected by examining the HTTP response code returned to the client. However, it is still possible for a <code>200</code> response code to be returned to the client but for the associated operation to fail.</li>
<li>When using the scheduler API, detecting that a dynamic reservation has failed is a little tricky: reservations do not have unique identifiers, and the Mesos master does not provide explicit feedback on whether a reservation request has succeeded or failed. Hence, framework schedulers typically use a combination of two techniques:<ol type="1">
<li>They use timeouts to detect that a reservation request may have failed (because they don't receive a resource offer containing the expected resources after a given period of time).</li>
<li>To check whether a resource offer includes the effect of a dynamic reservation, applications <em>cannot</em> check for the presence of a "reservation
     ID" or similar value (because reservations do not have IDs). Instead, applications should examine the resource offer and check it contains sufficient reserved resources for the application's role. If it does not, the application should make additional reservation requests as necessary.</li>
</ol>
</li>
<li>When a scheduler issues a dynamic reservation request, the reserved resources might <em>not</em> be present in the next resource offer the scheduler receives. There are two reasons for this: first, the reservation request might fail or be dropped by the network, as discussed above. Second, the reservation request might simply be delayed, so that the next resource offer from the master will be issued before the reservation request is received by the master. This is why the text above suggests that applications wait for a timeout before assuming that a reservation request should be retried.</li>
<li>A consequence of using timeouts to detect failures is that an application might submit more reservation requests than intended (e.g., a timeout fires and an application makes another reservation request; meanwhile, the original reservation request is also processed). Recall that two reservations for the same role at the same agent are "merged": for example, role <code>foo</code> makes two requests to reserve 2 CPUs at a single agent and both reservation requests succeed, the result will be a single reservation of 4 CPUs. To handle this situation, applications should be prepared for resource offers that contain more resources than expected. Some applications may also want to detect this situation and unreserve an additional reserved resources that will not be required.</li>
<li>It often makes sense to structure application logic as a "state machine", where the application moves from its initial state (no reserved resources and no persistent volumes) and eventually transitions toward a single terminal state (necessary resources reserved and persistent volume created). As new events (such as timeouts and resource offers) are received, the application compares the event with its current state and decides what action to take next.</li>
<li>Because persistent volumes are associated with roles, a volume might be offered to <em>any</em> of the frameworks that are registered in that role. For example, a persistent volume might be created by one framework and then offered to a different framework in the same role. This can be used to pass large volumes of data between frameworks in a convenient way. However, this behavior might also allow sensitive data created by one framework to be read or modified by another framework in the same role. It can also make it more difficult for frameworks to determine whether a dynamic reservation has succeeded: as discussed above, frameworks need to wait for an offer that contains the "expected" reserved resources to determine when a reservation request has succeeded. Determining what a framework should "expect" to find in an offer is more difficult when multiple frameworks can be making reservations for the same role concurrently. In general, whenever multiple frameworks are allowed to register in the same role, the operator should ensure that those frameworks are configured to collaborate with one another when using role-specific resources. For more information, see the discussion of <a href="roles.md#roles-multiple-frameworks">multiple frameworks in the same role</a>. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
