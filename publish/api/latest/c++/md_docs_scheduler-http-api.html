<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: scheduler-http-api</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">scheduler-http-api </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>Scheduler HTTP API</h1>
<p>Mesos 0.24.0 added <b>experimental</b> support for v1 Scheduler HTTP API.</p>
<h2>Overview</h2>
<p>The scheduler interacts with Mesos via "/api/v1/scheduler" endpoint hosted by the Mesos master. The fully qualified URL of the endpoint might look like: </p><pre class="fragment">    http://masterhost:5050/api/v1/scheduler
</pre><p>Note that we refer to this endpoint with its suffix "/scheduler" in the rest of this document. This endpoint accepts HTTP POST requests with data encoded as <a class="el" href="namespaceJSON.html">JSON</a> (Content-Type: application/json) or binary Protobuf (Content-Type: application/x-protobuf). The first request that a scheduler sends to "/scheduler" endpoint is called SUBSCRIBE and results in a streaming response ("200 OK" status code with Transfer-Encoding: chunked). <b>Schedulers are expected to keep the subscription connection open as long as possible (barring errors in network, software, hardware etc.) and incrementally process the response</b> (NOTE: HTTP client libraries that can only parse the response after the connection is closed cannot be used). For the encoding used, please refer to <b>Events</b> section below.</p>
<p>All the subsequent (non subscribe) requests to "/scheduler" endpoint (see details below in <b>Calls</b> section) must be sent using a different connection(s) than the one being used for subscription. Master responds to these HTTP POST requests with "202 Accepted" status codes (or, for unsuccessful requests, with 4xx or 5xx status codes; details in later sections). The "202 Accepted" response means that a request has been accepted for processing, not that the processing of the request has been completed. The request might or might not be acted upon by Mesos (e.g., master fails during the processing of the request). Any asynchronous responses from these requests will be streamed on long-lived subscription connection.</p>
<h2>Calls</h2>
<p>The following calls are currently accepted by the master. The canonical source of this information is <a href="https://github.com/apache/mesos/blob/master/include/mesos/v1/scheduler/scheduler.proto">scheduler.proto</a> (NOTE: The protobuf definitions are subject to change before the beta API is finalized). Note that when sending <a class="el" href="namespaceJSON.html">JSON</a> encoded Calls, schedulers should encode raw bytes in Base64 and strings in UTF-8.</p>
<h3>RecordIO response format</h3>
<p>The response returned from the <code>SUBSCRIBE</code> call (see <a href="#subscribe">below</a> is encoded in RecordIO format, which essentially prepends to a single record (either <a class="el" href="namespaceJSON.html">JSON</a> or serialized Protobuf) its length in bytes, followed by a newline and then the data:</p>
<p>The <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec2.html#sec2.1">BNF grammar</a> for a RecordIO-encoded streaming response is:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;records         = *record</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;record          = record-size LF record-data</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;record-size     = 1*DIGIT</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;record-data     = record-size(OCTET)</div></div><!-- fragment --><p><code>record-size</code> should be interpreted as an unsigned 64-bit integer (<code>uint64</code>).</p>
<p>For example, a stream may look like:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;128\n</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{&quot;type&quot;: &quot;SUBSCRIBED&quot;,&quot;subscribed&quot;: {&quot;framework_id&quot;: {&quot;value&quot;:&quot;12220-3440-12532-2345&quot;},...}104\n</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{&quot;framework_id&quot;: {&quot;value&quot;: &quot;12220-3440-12532-2345&quot;},...{&quot;value&quot; : &quot;12220-3440-12532-O12&quot;},}208\n</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;...</div></div><!-- fragment --><p>In pseudo-code, this could be parsed with something like the following:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;while (true) {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  do {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    lengthBytes = readline()</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  } while (lengthBytes.length &lt; 1)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  messageLength = parseInt(lengthBytes);</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  messageBytes = read(messageLength);</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  process(messageBytes);</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;}</div></div><!-- fragment --><p><a class="el" href="classNetwork.html">Network</a> intermediaries e.g. proxies are free to change the chunk boundaries and this should not have any effect on the recipient application (scheduler layer). We wanted a way to delimit/encode two events for JSON/Protobuf responses consistently and RecordIO format allowed us to do that.</p>
<h3>SUBSCRIBE</h3>
<p>This is the first step in the communication process between the scheduler and the master. This is also to be considered as subscription to the "/scheduler" events stream.</p>
<p>To subscribe with the master, the scheduler sends a HTTP POST request with encoded <code>SUBSCRIBE</code> message with the required FrameworkInfo. Note that if "subscribe.framework_info.id" is not set, master considers the scheduler as a new one and subscribes it by assigning it a FrameworkID. The HTTP response is a stream with RecordIO encoding, with the first event being <code>SUBSCRIBED</code> event (see details in <b>Events</b> section).</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;SUBSCRIBE Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Accept: application/json</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;Connection: close</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;{</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;   &quot;type&quot;               : &quot;SUBSCRIBE&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;   &quot;subscribe&quot;  : {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      &quot;framework_info&quot;  : {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        &quot;user&quot; :  &quot;foo&quot;,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        &quot;name&quot; :  &quot;Example HTTP Framework&quot;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;      },</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      &quot;force&quot; : true</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;SUBSCRIBE Response Event (JSON):</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;HTTP/1.1 200 OK</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;Transfer-Encoding: chunked</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;&lt;event length&gt;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; &quot;type&quot;                 : &quot;SUBSCRIBED&quot;,</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; &quot;subscribed&quot;   : {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;     &quot;framework_id&quot;               : {&quot;value&quot;:&quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;     &quot;heartbeat_interval_seconds&quot; : 15</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  }</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;&lt;more events&gt;</div></div><!-- fragment --><p>Alternatively, if "subscribe.framework_info.id" is set, master considers this a request from an already subscribed scheduler reconnecting after a disconnection (e.g., due to failover or network disconnection) and responds with <code>SUBSCRIBED</code> event containing the same FrameworkID. The "subscribe.force" field describes how the master reacts when multiple scheduler instances (with the same framework id) attempt to subscribe with the master at the same time (e.g., due to network partition). See the semantics in <b>Disconnections</b> section below.</p>
<p>NOTE: In the old version of the API, (re-)registered callbacks also included MasterInfo, which contained information about the master the driver currently connected to. With the new API, since schedulers explicitly subscribe with the leading master (see details below in <b>Master Detection</b> section), it's not relevant anymore.</p>
<p>If subscription fails for whatever reason (e.g., invalid request), a HTTP 4xx response is returned with the error message as part of the body and the connection is closed.</p>
<p>Scheduler must make additional HTTP requests to the "/scheduler" endpoint only after it has opened a persistent connection to it by sending a <code>SUBSCRIBE</code> request and received a <code>SUBSCRIBED</code> response. Calls made without subscription will result in a "403 Forbidden" instead of a "202 Accepted" response. A scheduler might also receive a "400 Bad Request" response if the HTTP request is malformed (e.g., malformed HTTP headers).</p>
<h3>TEARDOWN</h3>
<p>Sent by the scheduler when it wants to tear itself down. When Mesos receives this request it will shut down all executors (and consequently kill tasks) and remove persistent volumes (if requested). It then removes the framework and closes all open connections from this scheduler to the Master.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;TEARDOWN Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;TEARDOWN&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;}</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;TEARDOWN Response:</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>ACCEPT</h3>
<p>Sent by the scheduler when it accepts offer(s) sent by the master. The <code>ACCEPT</code> request includes the type of operations (e.g., launch task, reserve resources, create volumes) that the scheduler wants to perform on the offers. Note that until the scheduler replies (accepts or declines) to an offer, its resources are considered allocated to the framework. Also, any of the offer's resources not used in the <code>ACCEPT</code> call (e.g., to launch a task) are considered declined and might be reoffered to other frameworks. In other words, the same <code>OfferID</code> cannot be used in more than one <code>ACCEPT</code> call. These semantics might change when we add new features to Mesos (e.g., persistence, reservations, optimistic offers, resizeTask, etc.).</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ACCEPT Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;ACCEPT&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;accept&quot;                      : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;offer_ids&quot;         : [</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                       {&quot;value&quot; : &quot;12220-3440-12532-O12&quot;},</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                       {&quot;value&quot; : &quot;12220-3440-12532-O12&quot;}</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                      ],</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    &quot;operations&quot;        : [ {&quot;type&quot; : &quot;LAUNCH&quot;, &quot;launch&quot; : {...}} ],</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    &quot;filters&quot;           : {...}</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  }</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;}</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;ACCEPT Response:</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>DECLINE</h3>
<p>Sent by the scheduler to explicitly decline offer(s) received. Note that this is same as sending an <code>ACCEPT</code> call with no operations.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;DECLINE Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;DECLINE&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;decline&quot;                     : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;offer_ids&quot; : [</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                   {&quot;value&quot; : &quot;12220-3440-12532-O12&quot;},</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                   {&quot;value&quot; : &quot;12220-3440-12532-O13&quot;}</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                  ],</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    &quot;filters&quot;   : {...}</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  }</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;}</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;DECLINE Response:</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>REVIVE</h3>
<p>Sent by the scheduler to remove any/all filters that it has previously set via <code>ACCEPT</code> or <code>DECLINE</code> calls.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;REVIVE Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;REVIVE&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;}</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;REVIVE Response:</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>KILL</h3>
<p>Sent by the scheduler to kill a specific task. If the scheduler has a custom executor, the kill is forwarded to the executor and it is up to the executor to kill the task and send a <code>TASK_KILLED</code> (or <code>TASK_FAILED</code>) update. Mesos releases the resources for a task once it receives a terminal update for the task. If the task is unknown to the master, a <code>TASK_LOST</code> will be generated.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;KILL Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;KILL&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;kill&quot;                        : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;task_id&quot;   :  {&quot;value&quot; : &quot;12220-3440-12532-my-task&quot;},</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &quot;agent_id&quot;  :  {&quot;value&quot; : &quot;12220-3440-12532-S1233&quot;}</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  }</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;}</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;KILL Response:</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>SHUTDOWN</h3>
<p>Sent by the scheduler to shutdown a specific custom executor (NOTE: This is a new call that was not present in the old API). When an executor gets a shutdown event, it is expected to kill all its tasks (and send <code>TASK_KILLED</code> updates) and terminate. If an executor doesn't terminate within a certain timeout (configurable via "--executor_shutdown_grace_period" agent flag), the agent will forcefully destroy the container (executor and its tasks) and transitions its active tasks to <code>TASK_LOST</code>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;SHUTDOWN Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;SHUTDOWN&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;shutdown&quot;            : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;executor_id&quot;       :  {&quot;value&quot; : &quot;123450-2340-1232-my-executor&quot;},</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &quot;agent_id&quot;          :  {&quot;value&quot; : &quot;12220-3440-12532-S1233&quot;}</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  }</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;}</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;SHUTDOWN Response:</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>ACKNOWLEDGE</h3>
<p>Sent by the scheduler to acknowledge a status update. Note that with the new API, schedulers are responsible for explicitly acknowledging the receipt of status updates that have "status.uuid()" set. These status updates are reliably retried until they are acknowledged by the scheduler. The scheduler must not acknowledge status updates that do not have "status.uuid()" set as they are not retried. "uuid" is raw bytes encoded in Base64.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ACKNOWLEDGE Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;ACKNOWLEDGE&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;acknowledge&quot;         : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;agent_id&quot;  :  {&quot;value&quot; : &quot;12220-3440-12532-S1233&quot;},</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &quot;task_id&quot;   :  {&quot;value&quot; : &quot;12220-3440-12532-my-task&quot;},</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    &quot;uuid&quot;              :  &quot;jhadf73jhakdlfha723adf&quot;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;}</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;ACKNOWLEDGE Response:</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>RECONCILE</h3>
<p>Sent by the scheduler to query the status of non-terminal tasks. This causes the master to send back <code>UPDATE</code> events for each task in the list. Tasks that are no longer known to Mesos will result in <code>TASK_LOST</code> updates. If the list of tasks is empty, master will send <code>UPDATE</code> events for all currently known tasks of the framework.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;RECONCILE Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler   HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;RECONCILE&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;reconcile&quot;           : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;tasks&quot;             : [</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                   { &quot;task_id&quot;  : { &quot;value&quot; : &quot;312325&quot; },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                     &quot;agent_id&quot; : { &quot;value&quot; : &quot;123535&quot; }</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                   }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                  ]</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  }</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;}</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;RECONCILE Response:</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>MESSAGE</h3>
<p>Sent by the scheduler to send arbitrary binary data to the executor. Note that Mesos neither interprets this data nor makes any guarantees about the delivery of this message to the executor. "data" is raw bytes encoded in Base64.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MESSAGE Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler   HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;MESSAGE&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;message&quot;                     : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;agent_id&quot;       : {&quot;value&quot; : &quot;12220-3440-12532-S1233&quot;},</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &quot;executor_id&quot;    : {&quot;value&quot; : &quot;my-framework-executor&quot;},</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    &quot;data&quot;           : &quot;adaf838jahd748jnaldf&quot;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;}</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;MESSAGE Response:</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h3>REQUEST</h3>
<p>Sent by the scheduler to request resources from the master/allocator. The built-in hierarchical allocator simply ignores this request but other allocators (modules) can interpret this in a customizable fashion.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Request (JSON):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler   HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &quot;framework_id&quot;        : {&quot;value&quot; : &quot;12220-3440-12532-2345&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  &quot;type&quot;                        : &quot;REQUEST&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;requests&quot;            : [</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      {</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;         &quot;agent_id&quot;       : {&quot;value&quot; : &quot;12220-3440-12532-S1233&quot;},</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;         &quot;resources&quot;      : {}</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      },</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  ]</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;}</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;REQUEST Response:</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;HTTP/1.1 202 Accepted</div></div><!-- fragment --><h2>Events</h2>
<p>Scheduler is expected to keep a <b>persistent</b> connection open to "/scheduler" endpoint even after getting a SUBSCRIBED HTTP Response event. This is indicated by "Connection: keep-alive" and "Transfer-Encoding: chunked" headers with <em>no</em> "Content-Length" header set. All subsequent events that are relevant to this framework generated by Mesos are streamed on this connection. Master encodes each Event in RecordIO format, i.e., string representation of length of the event in bytes followed by <a class="el" href="namespaceJSON.html">JSON</a> or binary Protobuf (possibly compressed) encoded event. Note that the value of length will never be '0' and the size of the length will be the size of unsigned integer (i.e., 64 bits). Also, note that the RecordIO encoding should be decoded by the scheduler whereas the underlying HTTP chunked encoding is typically invisible at the application (scheduler) layer. The type of content encoding used for the events will be determined by the accept header of the POST request (e.g., Accept: application/json).</p>
<p>The following events are currently sent by the master. The canonical source of this information is at <a href="include/mesos/v1/scheduler/scheduler.proto">scheduler.proto</a>. Note that when sending <a class="el" href="namespaceJSON.html">JSON</a> encoded events, master encodes raw bytes in Base64 and strings in UTF-8.</p>
<h3>SUBSCRIBED</h3>
<p>The first event sent by the master when the scheduler sends a <code>SUBSCRIBE</code> request on the persistent connection. See <code>SUBSCRIBE</code> in Calls section for the format.</p>
<h3>OFFERS</h3>
<p>Sent by the master whenever there are new resources that can be offered to the framework. Each offer corresponds to a set of resources on an agent. Until the scheduler 'Accept's or 'Decline's an offer the resources are considered allocated to the scheduler, unless the offer is otherwise rescinded, e.g. due to a lost agent or <code>--offer_timeout</code>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;OFFERS Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;type&quot;        : &quot;OFFERS&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;offers&quot;      : [</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;offer_id&quot;:{&quot;value&quot;: &quot;12214-23523-O235235&quot;},</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;framework_id&quot;:{&quot;value&quot;: &quot;12124-235325-32425&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &quot;agent_id&quot;:{&quot;value&quot;: &quot;12325-23523-S23523&quot;},</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &quot;hostname&quot;:&quot;agent.host&quot;,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &quot;resources&quot;:[...],</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      &quot;attributes&quot;:[...],</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;      &quot;executor_ids&quot;:[]</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  ]</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;}</div></div><!-- fragment --><h3>RESCIND</h3>
<p>Sent by the master when a particular offer is no longer valid (e.g., the agent corresponding to the offer has been removed) and hence needs to be rescinded. Any future calls (<code>ACCEPT</code> / <code>DECLINE</code>) made by the scheduler regarding this offer will be invalid.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;RESCIND Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;type&quot;        : &quot;RESCIND&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;rescind&quot;     : {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;offer_id&quot;  : { &quot;value&quot; : &quot;12214-23523-O235235&quot;}</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  }</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;}</div></div><!-- fragment --><h3>UPDATE</h3>
<p>Sent by the master whenever there is a status update that is generated by the executor, agent or master. Status updates should be used by executors to reliably communicate the status of the tasks that they manage. It is crucial that a terminal update (e.g., <code>TASK_FINISHED</code>, <code>TASK_KILLED</code>, <code>TASK_FAILED</code>) is sent by the executor as soon as the task terminates, in order for Mesos to release the resources allocated to the task. It is also the responsibility of the scheduler to explicitly acknowledge the receipt of status updates that are reliably retried. See <code>ACKNOWLEDGE</code> in the Calls section above for the semantics. Note that <code>uuid</code> and <code>data</code> are raw bytes encoded in Base64.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;UPDATE Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;type&quot;        : &quot;UPDATE&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;update&quot;      : {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &quot;status&quot;    : {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;task_id&quot;       : { &quot;value&quot; : &quot;12344-my-task&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &quot;state&quot;         : &quot;TASK_RUNNING&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        &quot;source&quot;        : &quot;SOURCE_EXECUTOR&quot;,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        &quot;uuid&quot;          : &quot;adfadfadbhgvjayd23r2uahj&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        &quot;bytes&quot;         : &quot;uhdjfhuagdj63d7hadkf&quot;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  }</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;}</div></div><!-- fragment --><h3>MESSAGE</h3>
<p>A custom message generated by the executor that is forwarded to the scheduler by the master. Note that this message is not interpreted by Mesos and is only forwarded (without reliability guarantees) to the scheduler. It is up to the executor to retry if the message is dropped for any reason. Note that <code>data</code> is raw bytes encoded as Base64.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MESSAGE Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;type&quot;        : &quot;MESSAGE&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;message&quot;     : {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &quot;agent_id&quot;          : { &quot;value&quot; : &quot;12214-23523-S235235&quot;},</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &quot;executor_id&quot;       : { &quot;value&quot; : &quot;12214-23523-my-executor&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &quot;data&quot;                      : &quot;adfadf3t2wa3353dfadf&quot;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  }</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;}</div></div><!-- fragment --><h3>FAILURE</h3>
<p>Sent by the master when an agent is removed from the cluster (e.g., failed health checks) or when an executor is terminated. Note that, this event coincides with receipt of terminal <code>UPDATE</code> events for any active tasks belonging to the agent or executor and receipt of <code>RESCIND</code> events for any outstanding offers belonging to the agent. Note that there is no guaranteed order between the <code>FAILURE</code>, <code>UPDATE</code> and <code>RESCIND</code> events.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;FAILURE Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;type&quot;        : &quot;FAILURE&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;failure&quot;     : {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &quot;agent_id&quot;          : { &quot;value&quot; : &quot;12214-23523-S235235&quot;},</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &quot;executor_id&quot;       : { &quot;value&quot; : &quot;12214-23523-my-executor&quot;},</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &quot;status&quot;            : 1</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  }</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;}</div></div><!-- fragment --><h3>ERROR</h3>
<p>Sent by the master when an asynchronous error event is generated (e.g., a framework is not authorized to subscribe with the given role). It is recommended that the framework abort when it receives an error and retry subscription as necessary.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ERROR Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;type&quot;        : &quot;ERROR&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;message&quot;     : &quot;Framework is not authorized&quot;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}</div></div><!-- fragment --><h3>HEARTBEAT</h3>
<p>This event is periodically sent by the master to inform the scheduler that a connection is alive. This also helps ensure that network intermediates do not close the persistent subscription connection due to lack of data flow. See the next section on how a scheduler can use this event to deal with network partitions.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;HEARTBEAT Event (JSON)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;event-length&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;type&quot;        : &quot;HEARTBEAT&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;}</div></div><!-- fragment --><h2>Disconnections</h2>
<p>Master considers a scheduler disconnected if the persistent subscription connection (opened via <code>SUBSCRIBE</code> request) to "/scheduler" breaks. The connection could break for several reasons, e.g., scheduler restart, scheduler failover, network error. Note that the master doesn't keep track of non-subscription connection(s) to "/scheduler" because it is not expected to be a persistent connection.</p>
<p>If master realizes that the subscription connection is broken, it marks the scheduler as "disconnected" and starts a failover timeout (failover timeout is part of FrameworkInfo). It also drops any pending events in its queue. Additionally, it rejects subsequent non-subscribe HTTP requests to "/scheduler" with "403 Forbidden", until the scheduler subscribes again with "/scheduler". If the scheduler <em>does not</em> re-subscribe within the failover timeout, the master considers the scheduler gone forever and shuts down all its executors, thus killing all its tasks. Therefore, all production schedulers are recommended to use a high value (e.g., 4 weeks) for the failover timeout.</p>
<p>NOTE: To force shutdown a framework before the framework timeout elapses (e.g., during framework development and testing), either the framework can send <code>TEARDOWN</code> call (part of Scheduler API) or an operator can use the "/master/teardown" endpoint (part of Operator API).</p>
<p>If the scheduler realizes that its subscription connection to "/scheduler" is broken, it should attempt to open a new persistent connection to the "/scheduler" (on possibly new master based on the result of master detection) and resubscribe. It should not send new non-subscribe HTTP requests to "/scheduler" unless it gets a <code>SUBSCRIBED</code> event; such requests will result in "403 Forbidden".</p>
<p>If the master does not realize that the subscription connection is broken, but the scheduler realizes it, the scheduler might open a new persistent connection to "/scheduler" via <code>SUBSCRIBE</code>. In this case, the semantics depend on the value of <code>subscribe.force</code>. If set to true, master closes the existing subscription connection and allows subscription on the new connection. If set to false, the new connection attempt is disallowed in favor of the existing connection. The invariant here is that, only one persistent subscription connection for a given FrameworkID is allowed on the master. For HA schedulers, it is recommended that a scheduler instance set <code>subscribe.force</code> to true only when it just got elected and set it to false for all subsequent reconnection attempts (e.g, due to disconnection or master failover).</p>
<h3><a class="el" href="classNetwork.html">Network</a> partitions</h3>
<p>In the case of a network partition, the subscription connection between the scheduler and master might not necessarily break. To be able to detect this scenario, master periodically (e.g., 15s) sends <code>HEARTBEAT</code> events (similar in vein to Twitter's Streaming API). If a scheduler doesn't receive a bunch (e.g., 5) of these heartbeats within a time window, it should immediately disconnect and try to re-subscribe. It is highly recommended for schedulers to use an exponential backoff strategy (e.g., upto a maximum of 15s) to avoid overwhelming the master while reconnecting. Schedulers can use a similar timeout (e.g., 75s) for receiving responses to any HTTP requests.</p>
<h2>Master detection</h2>
<p>Mesos has a high-availability mode that uses multiple Mesos masters; one active master (called the leader or leading master) and several standbys in case it fails. The masters elect the leader, with <a class="el" href="classZooKeeper.html">ZooKeeper</a> coordinating the election. For more details please refer to the <a class="el" href="high-availability_8md.html">documentation</a>.</p>
<p>Schedulers are expected to make HTTP requests to the leading master. If requests are made to a non-leading master a "HTTP 307 Temporary Redirect" will be received with the "Location" header pointing to the leading master.</p>
<p>Example subscription workflow with redirection when the scheduler hits a non-leading master.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Scheduler -&gt; Master</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Host: masterhost1:5050</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Accept: application/json</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Connection: keep-alive</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  &quot;framework_info&quot;      : {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;user&quot; :  &quot;foo&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &quot;name&quot; :  &quot;Example HTTP Framework&quot;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  },</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  &quot;type&quot;                        : &quot;SUBSCRIBE&quot;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;}</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;Master -&gt; Scheduler</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;HTTP/1.1 307 Temporary Redirect</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;Location: masterhost2:5050</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;Scheduler -&gt; Master</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;POST /api/v1/scheduler  HTTP/1.1</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;Host: masterhost2:5050</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;Content-Type: application/json</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;Accept: application/json</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;Connection: keep-alive</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;{</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  &quot;framework_info&quot;      : {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    &quot;user&quot; :  &quot;foo&quot;,</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    &quot;name&quot; :  &quot;Example HTTP Framework&quot;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  },</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  &quot;type&quot;                        : &quot;SUBSCRIBE&quot;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div></div><!-- fragment --><p>If the scheduler knows the list of master's hostnames for a cluster, it could use this mechanism to find the leading master to subscribe with. Alternatively, the scheduler could use a pure language library that detects the leading master given a <a class="el" href="classZooKeeper.html">ZooKeeper</a> (or etcd) URL. For a <code>C++</code> library that does <a class="el" href="classZooKeeper.html">ZooKeeper</a> based master detection please look at <code>src/scheduler/scheduler.cpp</code>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
