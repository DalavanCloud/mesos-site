<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: allocation-module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">allocation-module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>Mesos Allocation Modules</h1>
<p>The logic that the Mesos master uses to determine which frameworks to make resource offers to is encapsulated in the master's <em>allocator module</em>. The allocator is a pluggable component that organizations can use to implement their own sharing policy, e.g. fair-sharing, priority, etc., or tune the default hierarchical Dominant Resource Fairness algorithm (see <a href="https://www.cs.berkeley.edu/~alig/papers/drf.pdf">the DRF paper</a>).</p>
<p>To use a custom allocator in Mesos, one must:</p>
<ul>
<li><a href="#writing-a-custom-allocator">Implement</a> the <code>Allocator</code> interface as defined in <code><a class="el" href="include_2mesos_2master_2allocator_8hpp.html">mesos/master/allocator.hpp</a></code>,</li>
<li><a href="#wiring-up-a-custom-allocator">Wrap</a> the allocator implementation in a module and load it in the Mesos master.</li>
</ul>
<h2>Writing a custom allocator</h2>
<p>Allocator modules are implemented in C++, the same language in which Mesos is written. They must subclass the <code>Allocator</code> interface defined in <code><a class="el" href="include_2mesos_2master_2allocator_8hpp.html">mesos/master/allocator.hpp</a></code>. However, your implementation can be a C++ proxy, which delegates calls to an actual allocator written in a language of your choice.</p>
<p>The default allocator is <code>HierarchicalDRFAllocatorProcess</code>, which lives in <code>$MESOS_HOME/src/master/allocator/mesos/hierarchical.hpp</code>. Like most Mesos components, it is actor-based, which means all interface methods are non-blocking and return immediately after putting the corresponding action into the actor's queue. If you would like to design your custom allocator in a similar manner, subclass <code>MesosAllocatorProcess</code> from <code>$MESOS_HOME/src/master/allocator/mesos/allocator.hpp</code> and wrap your actor-based allocator in <code>MesosAllocator</code>. This dispatches calls to the underlying actor and controls its lifetime. You can refer to <code>HierarchicalDRFAllocatorProcess</code> as a starting place if you choose to write your own actor-based allocation module.</p>
<p>Additionally, the built-in hierarchical allocator can be extended without the need to reimplement the entirety of the allocation logic. This is possible through the use of the <code>Sorter</code> abstraction. Sorters define the order in which hierarchy layers (e.g. roles or frameworks) should be offered resources by taking "client" objects and some information about those clients and returning an ordered list of clients.</p>
<p>Sorters are implemented in C++ and inherit the <code>Sorter</code> class defined in <code>$MESOS_HOME/src/master/allocator/sorter/sorter.hpp</code>. The default sorter is <code>DRFSorter</code>, which implements fair sharing and can be found in <code>$MESOS_HOME/src/master/allocator/sorter/drf/sorter.hpp</code>. This sorter is capable of expressing priorities by specifying weights in <code><a class="el" href="namespaceprocess_1_1metrics.html#a15af50f3f4dbcca2f7c619ccfbaa70b2">Sorter::add()</a></code>. Each client's share is divided by its weight. For example, a role that has a weight of 2 will be offered twice as many resources as a role with weight 1.</p>
<h2>Wiring up a custom allocator</h2>
<p>Once a custom allocator has been written, the next step is to override the built-in implementation with your own. This process consists of several steps:</p>
<ul>
<li>Wrap your allocator in a Mesos allocator module,</li>
<li>Load this module in Mesos master.</li>
</ul>
<p>An allocator module is a factory function and a module description, as defined in <code><a class="el" href="include_2mesos_2module_2allocator_8hpp.html">mesos/module/allocator.hpp</a></code>. Assuming the allocation logic is implemented by the <code>ExternalAllocator</code> class declared in <code>external_allocator.hpp</code>, the following snippet describes the implementation of an allocator module named <code>ExternalAllocatorModule</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2mesos_2master_2allocator_8hpp.html">mesos/master/allocator.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="include_2mesos_2module_2allocator_8hpp.html">mesos/module/allocator.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="try_8hpp.html">stout/try.hpp</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;external_allocator.hpp&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacemesos.html">mesos</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="classmesos_1_1master_1_1allocator_1_1Allocator.html">mesos::master::allocator::Allocator</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="namespacemesos_1_1internal_1_1master_1_1allocator.html#a2697b55e9bb55b527e433d5e378ea4ba">mesos::internal::master::allocator::HierarchicalDRFAllocator</a>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> Allocator* createExternalAllocator(<span class="keyword">const</span> Parameters&amp; parameters)</div><div class="line">{</div><div class="line">  <a class="code" href="classTry.html">Try&lt;Allocator*&gt;</a> allocator = <a class="code" href="namespacecgroups.html#a2ecc89636706df947027a4c3c2100fbe">ExternalAllocator::create</a>();</div><div class="line">  <span class="keywordflow">if</span> (allocator.<a class="code" href="classTry.html#a2e52c7006437d2cf421b373f75e3c767">isError</a>()) {</div><div class="line">    <span class="keywordflow">return</span> NULL;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> allocator.<a class="code" href="classTry.html#afb0e8411017a05b25bea3b851502886e">get</a>();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Declares an ExternalAllocator module named &#39;ExternalAllocatorModule&#39;.</span></div><div class="line"><a class="code" href="structmesos_1_1modules_1_1Module.html">mesos::modules::Module&lt;Allocator&gt;</a> ExternalAllocatorModule(</div><div class="line">    <a class="code" href="include_2mesos_2module_8hpp.html#adf787bc78b1f3ba0b0ecf71a0487ee2a">MESOS_MODULE_API_VERSION</a>,</div><div class="line">    MESOS_VERSION,</div><div class="line">    <span class="stringliteral">&quot;Mesos Contributor&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;engineer@example.com&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;External Allocator module.&quot;</span>,</div><div class="line">    NULL,</div><div class="line">    createExternalAllocator);</div></div><!-- fragment --><p>Refer to the <a class="el" href="modules_8md.html">Mesos Modules documentation</a> for instructions on how to compile and load a module in Mesos master. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
