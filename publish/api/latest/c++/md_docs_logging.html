<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: logging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">logging </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>Logging</h1>
<p>Mesos handles the logs of each Mesos component differently depending on the degree of control Mesos has over the source code of the component.</p>
<p>Roughly, these categories are:</p>
<ul>
<li><a href="#Internal">Internal</a> - Master and Agent.</li>
<li><a href="#Containers">Containers</a> - Executors and Tasks.</li>
<li>External - Components launched outside of Mesos, like Frameworks and <a class="el" href="high-availability_8md.html">ZooKeeper</a>. These are expected to implement their own logging solution.</li>
</ul>
<h2><a class="anchor" id="Internal"></a>Internal</h2>
<p>The Mesos Master and Agent use the <a href="https://github.com/google/glog">Google's logging library</a>. For information regarding the command-line options used to configure this library, see the <a class="el" href="configuration_8md.html">configuration documentation</a>. Google logging options that are not explicitly mentioned there can be configured via environment variables.</p>
<p>Both Master and Agent also expose an HTTP endpoint which temporarily toggles verbose logging:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;POST &lt;ip:port&gt;/logging/toggle?level=[1|2|3]&amp;duration=VALUE</div></div><!-- fragment --><p>The effect is analogous to setting the <code>GLOG_v</code> environment variable prior to starting the Master/Agent, except the logging level will revert to the original level after the given duration.</p>
<h2><a class="anchor" id="Containers"></a>Containers</h2>
<p>For background, see <a class="el" href="containerizer_8md.html">the containerizer documentation</a>.</p>
<p>Mesos does not assume any structured logging for entities running inside containers. Instead, Mesos will store the stdout and stderr of containers into plain files ("stdout" and "stderr") located inside <a href="sandbox.md#where-is-it">the sandbox</a>.</p>
<p>In some cases, the default Container logger behavior of Mesos is not ideal:</p>
<ul>
<li>Logging may not be standardized across containers.</li>
<li>Logs are not easily aggregated.</li>
<li>Log file sizes are not managed. Given enough time, the "stdout" and "stderr" files can fill up the Agent's disk.</li>
</ul>
<h2><code>ContainerLogger</code> Module</h2>
<p>The <code>ContainerLogger</code> module was introduced in Mesos 0.27.0 and aims to address the shortcomings of the default logging behavior for containers. The module can be used to change how Mesos redirects the stdout and stderr of containers.</p>
<p>The <a href="https://github.com/apache/mesos/blob/master/include/mesos/slave/container_logger.hpp">interface for a <code>ContainerLogger</code> can be found here</a>.</p>
<p>Mesos comes with two <code>ContainerLogger</code> modules:</p>
<ul>
<li>The <code>SandboxContainerLogger</code> implements the existing logging behavior as a <code>ContainerLogger</code>. This is the default behavior.</li>
<li>The <code>LogrotateContainerLogger</code> addresses the problem of unbounded log file sizes.</li>
</ul>
<h3><code>LogrotateContainerLogger</code></h3>
<p>The <code>LogrotateContainerLogger</code> constrains the total size of a container's stdout and stderr files. The module does this by rotating log files based on the parameters to the module. When a log file reaches its specified maximum size, it is renamed by appending a <code>.N</code> to the end of the filename, where <code>N</code> increments each rotation. Older log files are deleted when the specified maximum number of files is reached.</p>
<h4>Invoking the module</h4>
<p>The <code>LogrotateContainerLogger</code> can be loaded by specifying the library <code>liblogrotate_container_logger.so</code> in the <a href="modules.md#Invoking"><code>--modules</code> flag</a> when starting the Agent and by setting the <code>--container_logger</code> Agent flag to <code>org_apache_mesos_LogrotateContainerLogger</code>.</p>
<h4>Module parameters</h4>
<table  class="table table-striped">
</table>
<p>Key  </p>
<p>Explanation   &lt;/thead&gt;</p>
<p><code>max_stdout_size</code>/<code>max_stderr_size</code>  </p>
<p>Maximum size, in bytes, of a single stdout/stderr log file. When the size is reached, the file will be rotated.</p>
<p>Defaults to 10 MB. Minimum size of 1 (memory) page, usually around 4 KB.  </p>
<p><code>logrotate_stdout_options</code>/ <code>logrotate_stderr_options</code>  </p>
<p>Additional config options to pass into <code>logrotate</code> for stdout. This string will be inserted into a <code>logrotate</code> configuration file. i.e. For "stdout": </p><pre>
/path/to/stdout {
  [logrotate_stdout_options]
  size [max_stdout_size]
}</pre><p> NOTE: The <code>size</code> option will be overriden by this module.  </p>
<p><code>launcher_dir</code>  </p>
<p>Directory path of Mesos binaries. The <code>LogrotateContainerLogger</code> will find the <code>mesos-logrotate-logger</code> binary under this directory.</p>
<p>Defaults to <code>/usr/local/libexec/mesos</code>.  </p>
<p><code>logrotate_path</code>  </p>
<p>If specified, the <code>LogrotateContainerLogger</code> will use the specified <code>logrotate</code> instead of the system's <code>logrotate</code>. If <code>logrotate</code> is not found, then the module will exit with an error.   </p>
<h4>How it works</h4>
<ol type="1">
<li>Every time a container starts up, the <code>LogrotateContainerLogger</code> starts up companion subprocesses of the <code>mesos-logrotate-logger</code> binary.</li>
<li>The module instructs Mesos to redirect the container's stdout/stderr to the <code>mesos-logrotate-logger</code>.</li>
<li>As the container outputs to stdout/stderr, <code>mesos-logrotate-logger</code> will pipe the output into the "stdout"/"stderr" files. As the files grow, <code>mesos-logrotate-logger</code> will call <code>logrotate</code> to keep the files strictly under the configured maximum size.</li>
<li>When the container exits, <code>mesos-logrotate-logger</code> will finish logging before exiting as well.</li>
</ol>
<p>The <code>LogrotateContainerLogger</code> is designed to be resilient across Agent failover. If the Agent process dies, any instances of <code>mesos-logrotate-logger</code> will continue to run.</p>
<h3>Writing a Custom <code>ContainerLogger</code></h3>
<p>For basics on module writing, see <a class="el" href="modules_8md.html">the modules documentation</a>.</p>
<p>There are several caveats to consider when designing a new <code>ContainerLogger</code>:</p>
<ul>
<li>Logging by the <code>ContainerLogger</code> should be resilient to Agent failover. If the Agent process dies (which includes the <code>ContainerLogger</code> module), logging should continue. This is usually achieved by using subprocesses.</li>
<li>When containers shut down, the <code>ContainerLogger</code> is not explicitly notified. Instead, encountering <code>EOF</code> in the container's stdout/stderr signifies that the container has exited. This provides a stronger guarantee that the <code>ContainerLogger</code> has seen all the logs before exiting itself.</li>
<li>The <code>ContainerLogger</code> should not assume that containers have been launched with any specific <code>ContainerLogger</code>. The Agent may be restarted with a different <code>ContainerLogger</code>.</li>
<li>Each <a class="el" href="containerizer_8md.html">containerizer</a> running on an Agent uses its own instance of the <code>ContainerLogger</code>. This means more than one <code>ContainerLogger</code> may be running in a single Agent. However, each Agent will only run a single type of <code>ContainerLogger</code>. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
