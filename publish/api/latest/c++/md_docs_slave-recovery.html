<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: slave-recovery</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">slave-recovery </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>Slave Recovery</h1>
<p>Slave recovery is a feature of Mesos that allows:</p>
<ol type="1">
<li>Executors/tasks to keep running when the slave process is down and</li>
<li>Allows a restarted slave process to reconnect with running executors/tasks on the slave.</li>
</ol>
<p>Mesos slave could be restarted for an upgrade or due to a crash. This feature is introduced in ***0.14.0*** release.</p>
<h2>How does it work?</h2>
<p>Slave recovery works by having the slave checkpoint enough information (e.g., Task Info, Executor Info, Status Updates) about the running tasks and executors to local disk. Once a framework enables checkpointing, any subsequent slave restarts would recover the checkpointed information and reconnect with the executors. Note that if the host running the slave process is rebooted all the executors/tasks are killed.</p>
<blockquote class="doxtable">
<p>NOTE: To enable recovery the framework should explicitly request checkpointing. Alternatively, a framework that doesn't want the disk i/o overhead of checkpointing can opt out of checkpointing. </p>
</blockquote>
<h2>Enabling slave checkpointing</h2>
<blockquote class="doxtable">
<p>NOTE: From Mesos 0.22.0 slave checkpointing will be automatically enabled for all slaves. </p>
</blockquote>
<p>As part of this feature, 4 new flags were added to the slave.</p>
<ul>
<li><code>checkpoint</code> : Whether to checkpoint slave and frameworks information to disk [Default: true].<ul>
<li>This enables a restarted slave to recover status updates and reconnect with (&ndash;recover=reconnect) or kill (&ndash;recover=cleanup) old executors. &gt; NOTE: From Mesos 0.22.0 this flag will be removed as it will be enabled for all slaves.</li>
</ul>
</li>
<li><code>strict</code> : Whether to do recovery in strict mode [Default: true].<ul>
<li>If strict=true, any and all recovery errors are considered fatal.</li>
<li>If strict=false, any errors (e.g., corruption in checkpointed data) during recovery are ignored and as much state as possible is recovered.</li>
</ul>
</li>
<li><code>recover</code> : Whether to recover status updates and reconnect with old executors [Default: reconnect].<ul>
<li>If recover=reconnect, Reconnect with any old live executors.</li>
<li>If recover=cleanup, Kill any old live executors and exit. Use this option when doing an incompatible slave or executor upgrade!). &gt; NOTE: If no checkpointing information exists, no recovery is performed &gt; and the slave registers with the master as a new slave.</li>
</ul>
</li>
<li><code>recovery_timeout</code> : Amount of time allotted for the slave to recover [Default: 15 mins].<ul>
<li>If the slave takes longer than <code>recovery_timeout</code> to recover, any executors that are waiting to reconnect to the slave will self-terminate. &gt; NOTE: This flag is only applicable when <code>--checkpoint</code> is enabled.</li>
</ul>
</li>
</ul>
<blockquote class="doxtable">
<p>NOTE: If none of the frameworks have enabled checkpointing, executors/tasks of frameworks die when the slave dies and are not recovered. </p>
</blockquote>
<p>A restarted slave should re-register with master within a timeout (currently, 75s). If the slave takes longer than this timeout to re-register, the master shuts down the slave, which in turn shuts down any live executors/tasks. Therefore, it is highly recommended to automate the process of restarting a slave (e.g, using <a href="http://mmonit.com/monit/">monit</a>).</p>
<p><b>For the complete list of slave options: ./mesos-slave.sh &ndash;help</b></p>
<h2>Enabling framework checkpointing</h2>
<p>As part of this feature, <code>FrameworkInfo</code> has been updated to include an optional <code>checkpoint</code> field. A framework that would like to opt in to checkpointing should set <code>FrameworkInfo.checkpoint=True</code> before registering with the master.</p>
<h2>Known issues with <code>systemd</code> and POSIX isolation</h2>
<p>There is a known issue when using <code>systemd</code> to launch the <code>mesos-slave</code> while also using only <code>posix</code> isolation mechanisms that prevents tasks from recovering. The problem is that the default <a href="http://www.freedesktop.org/software/systemd/man/systemd.kill.html">KillMode</a> for systemd processes is <code>cgroup</code> and hence all child processes are killed when the slave stops. Explicitly setting <code>KillMode</code> to <code>process</code> allows the executors to survive and reconnect.</p>
<p>The following excerpt of a <code>systemd</code> unit configuration file shows how to set the flag:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[Service]</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;ExecStart=/usr/bin/mesos-slave</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;KillMode=process</div></div><!-- fragment --><blockquote class="doxtable">
<p>NOTE: There are also known issues with using <code>systemd</code> and raw <code>cgroups</code> based isolation, for now the suggested non-Posix isolation mechanism is to use <a class="el" href="classDocker.html">Docker</a> containerization. </p>
</blockquote>
<h2>Upgrading to 0.14.0</h2>
<p>If you want to upgrade a running Mesos cluster to 0.14.0 to take advantage of slave recovery please follow the <a class="el" href="upgrades_8md.html">upgrade instructions</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
