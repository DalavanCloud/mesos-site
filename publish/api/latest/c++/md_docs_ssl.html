<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: ssl</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ssl </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>SSL in Mesos</h1>
<p>By default, all the messages that flow through the Mesos cluster are unencrypted, making it possible for anyone with access to the cluster to intercept and potentially control arbitrary tasks.</p>
<p>SSL/TLS support was added to libprocess in Mesos 0.23.0, which encypts the low-level communication that Mesos uses for network communication between Mesos components. Additionally, HTTPS support was added to the Mesos WebUI.</p>
<h1>Configuration</h1>
<p>There is currently only one implementation of the <a href="https://github.com/apache/mesos/blob/master/3rdparty/libprocess/include/process/socket.hpp">libprocess socket interface</a> that supports SSL. This implementation uses <a href="https://github.com/libevent/libevent">libevent</a>. Specifically it relies on the <code>libevent-openssl</code> library that wraps <code>openssl</code>.</p>
<p>Before building Mesos 0.23.0 from source, assuming you have installed the required <a href="#Dependencies">Dependencies</a>, you can modify your configure line to enable SSL as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;../configure --enable-libevent --enable-ssl</div></div><!-- fragment --><h1>Running</h1>
<p>Once you have successfully built and installed your new binaries, here are the environment variables that are applicable to the <code>Master</code>, <code>Slave</code>, <code>Framework Scheduler/Executor</code>, or any <code>libprocess process</code>:</p>
<h4>SSL_ENABLED=(false|0,true|1) [default=false|0]</h4>
<p>Turn on or off SSL. When it is turned off it is the equivalent of default mesos with libevent as the backing for events. All sockets default to the non-SSL implementation. When it is turned on, the default configuration for sockets is SSL. This means outgoing connections will use SSL, and incoming connections will be expected to speak SSL as well. <a class="el" href="structNone.html">None</a> of the below flags are relevant if SSL is not enabled. If SSL is enabled, <code>SSL_CERT_FILE</code> and <code>SSL_KEY_FILE</code> must be supplied.</p>
<h4>SSL_SUPPORT_DOWNGRADE=(false|0,true|1) [default=false|0]</h4>
<p>Control whether or not non-SSL connections can be established. If this is enabled <b>on the accepting side</b>, then the accepting side will downgrade to a non-SSL socket if the connecting side is attempting to communicate via non-SSL. (e.g. HTTP). See <a href="#Upgrading">Upgrading Your Cluster</a> for more details.</p>
<h4>SSL_KEY_FILE=(path to key)</h4>
<p>The location of the private key used by OpenSSL.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// For example, to generate a key with OpenSSL:</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;openssl genrsa -des3 -f4 -passout pass:some_password -out key.pem 4096</div></div><!-- fragment --><h4>SSL_CERT_FILE=(path to certificate)</h4>
<p>The location of the certificate that will be presented.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// For example, to generate a certificate with OpenSSL:</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;openssl req -new -x509 -passin pass:some_password -days 365 -key key.pem -out cert.pem</div></div><!-- fragment --><h4>SSL_VERIFY_CERT=(false|0,true|1) [default=false|0]</h4>
<p>Control whether certificates are verified when presented. If this is false, even when a certificate is presented, it will not be verified. When <code>SSL_REQUIRE_CERT</code> is true, <code>SSL_VERIFY_CERT</code> is overridden and all certificates will be verified <em>and</em> required.</p>
<h4>SSL_REQUIRE_CERT=(false|0,true|1) [default=false|0]</h4>
<p>Enforce that certificates must be presented by connecting clients. This means all connections (including tools hitting endpoints) must present valid certificates in order to establish a connection.</p>
<h4>SSL_VERIFY_DEPTH=(N) [default=4]</h4>
<p>The maximum depth used to verify certificates. The default is 4. See the OpenSSL documentation or contact your system administrator to learn why you may want to change this.</p>
<h4>SSL_CA_DIR=(path to CA directory)</h4>
<p>The directory used to find the certificate authority / authorities. You can specify <code>SSL_CA_DIR</code> or <code>SSL_CA_FILE</code> depending on how you want to restrict your certificate authorization.</p>
<h4>SSL_CA_FILE=(path to CA file)</h4>
<p>The file used to find the certificate authority. You can specify <code>SSL_CA_DIR</code> or <code>SSL_CA_FILE</code> depending on how you want to restrict your certificate authorization.</p>
<h4>SSL_CIPHERS=(accepted ciphers separated by ':') [default=AES128-SHA:AES256-SHA:RC4-SHA:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA:DHE-RSA-AES256-SHA:DHE-DSS-AES256-SHA]</h4>
<p>A list of <code>:</code>-separated ciphers. Use these if you want to restrict or open up the accepted ciphers for OpenSSL. Read the OpenSSL documentation or contact your system administrators to see whether you want to override the default values.</p>
<h4>SSL_ENABLE_SSL_V3=(false|0,true|1) [default=false|0]</h4>
<h4>SSL_ENABLE_TLS_V1_0=(false|0,true|1) [default=false|0]</h4>
<h4>SSL_ENABLE_TLS_V1_1=(false|0,true|1) [default=false|0]</h4>
<h4>SSL_ENABLE_TLS_V1_2=(false|0,true|1) [default=true|1]</h4>
<p>The above switches enable / disable the specified protocols. By default only TLS V1.2 is enabled. SSL V2 is always disabled; there is no switch to enable it. The mentality here is to restrict security by default, and force users to open it up explicitly. Many older version of the protocols have known vulnerabilities, so only enable these if you fully understand the risks. <em>SSLv2 is disabled completely because modern versions of OpenSSL disable it using multiple compile time configuration options.</em> #<a class="anchor" id="Dependencies"></a>Dependencies</p>
<h3>libevent</h3>
<p>We require the OpenSSL support from libevent. The suggested version of libevent is <a href="https://github.com/libevent/libevent/releases/tag/release-2.0.22-stable"><code>2.0.22-stable</code></a>. As new releases come out we will try to maintain compatibility.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// For example, on OSX:</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;brew install libevent</div></div><!-- fragment --><h3>OpenSSL</h3>
<p>We require <a href="https://github.com/openssl/openssl">OpenSSL</a>. There are multiple branches of OpenSSL that are being maintained by the community. Since security requires being vigilant, we recommend reading the release notes for the current releases of OpenSSL and deciding on a version within your organization based on your security needs. Mesos is not too deeply dependent on specific OpenSSL versions, so there is room for you to make security decisions as an organization. Please ensure the <code>event2</code> and <code>openssl</code> headers are available for building mesos.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// For example, on OSX:</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;brew install openssl</div></div><!-- fragment --><h1><a class="anchor" id="Upgrading"></a>Upgrading Your Cluster</h1>
<p><em>There is no SSL specific requirement for upgrading different components in a specific order.</em></p>
<p>The recommended strategy is to restart all your components to enable SSL with downgrades support enabled. Once all components have SSL enabled, then do a second restart of all your components to disable downgrades. This strategy will allow each component to be restarted independently at your own convenience with no time restrictions. It will also allow you to try SSL in a subset of your cluster. <b>NOTE:</b> While different components in your cluster are serving SSL vs non-SSL traffic, any relative links in the WebUI may be broken. Please see the <a href="#WebUI">WebUI</a> section for details. Here are sample commands for upgrading your cluster:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// Restart each component with downgrade support (master, slave, framework):</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SSL_ENABLED=true SSL_SUPPORT_DOWNGRADE=true SSL_KEY_FILE=&lt;path-to-your-private-key&gt; SSL_CERT_FILE=&lt;path-to-your-certificate&gt; &lt;Any other SSL_* environment variables you may choose&gt; &lt;your-component (e.g. bin/master.sh)&gt; &lt;your-flags&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;// Restart each component WITHOUT downgrade support (master, slave, framework):</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;SSL_ENABLED=true SSL_SUPPORT_DOWNGRADE=false SSL_KEY_FILE=&lt;path-to-your-private-key&gt; SSL_CERT_FILE=&lt;path-to-your-certificate&gt; &lt;Any other SSL_* environment variables you may choose&gt; &lt;your-component (e.g. bin/master.sh)&gt; &lt;your-flags&gt;</div></div><!-- fragment --><p> The end state is a cluster that is only communicating with SSL.</p>
<p><b>NOTE:</b> Any tools you may use that communicate with your components must be able to speak SSL, or they will be denied. You may choose to maintain <code>SSL_SUPPORT_DOWNGRADE=true</code> for some time as you upgrade your internal tooling. The advantage of <code>SSL_SUPPORT_DOWNGRADE=true</code> is that all components that speak SSL will do so, while other components may still communicate over insecure channels.</p>
<h1><a class="anchor" id="WebUI"></a>WebUI</h1>
<p>The default Mesos WebUI uses relative links. Some of these links transition between endpoints served by the master and slaves. The WebUI currently does not have enough information to change the 'http' vs 'https' links based on whether the target endpoint is currently being served by an SSL-enabled binary. This may cause certain links in the WebUI to be broken when a cluster is in a transition state between SSL and non-SSL. Any tools that hit these endpoints will still be able to access them as long as they hit the endpoint using the right protocol, or the <code>SSL_SUPPORT_DOWNGRADE</code> option is set to true.</p>
<p><b>NOTE:</b> Frameworks with their own WebUI will need to add HTTPS support separately.</p>
<h3>Certificates</h3>
<p>Most browsers have built in protection that guard transitions between pages served using different certificates. For this reason you may choose to serve both the master and slave endpoints using a common certificate that covers multiple hostnames. If you do not do this, certain links, such as those to slave sandboxes, may seem broken as the browser treats the transition between differing certificates transition as unsafe. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
