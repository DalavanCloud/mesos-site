<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: authorization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">authorization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1>Authorization</h1>
<p>Authorization currently allows</p>
<ol type="1">
<li>Frameworks to (re-)register with authorized <em>roles</em>.</li>
<li>Frameworks to launch tasks/executors as authorized <em>users</em>.</li>
<li>Authorized <em>principals</em> to teardown frameworks through the "/teardown" HTTP endpoint.</li>
<li>Authorized <em>principals</em> to set and remove quotas through the "/quota" HTTP endpoint.</li>
<li>Authorized <em>principals</em> to reserve and unreserve resources through the "/reserve" and "/unreserve" HTTP endpoints, as well as with the <code>RESERVE</code> and <code>UNRESERVE</code> offer operations.</li>
<li>Authorized <em>principals</em> to create and destroy persistent volumes through the "/create-volumes" and "/destroy-volumes" HTTP endpoints, as well as with the <code>CREATE</code> and <code>DESTROY</code> offer operations.</li>
</ol>
<h2>ACLs</h2>
<p>Authorization is implemented via Access Control Lists (ACLs). For each of the above cases, ACLs can be used to restrict access. Operators can setup ACLs in <a class="el" href="namespaceJSON.html">JSON</a> format. See <a href="https://github.com/apache/mesos/blob/master/include/mesos/authorizer/authorizer.proto">authorizer.proto</a> for details.</p>
<p>Each ACL specifies a set of <code>Subjects</code> that can perform an <code>Action</code> on a set of <code>Objects</code>.</p>
<p>The currently supported <code>Actions</code> are:</p>
<ol type="1">
<li>"register_frameworks": Register frameworks</li>
<li>"run_tasks": Run tasks/executors</li>
<li>"teardown_frameworks": Teardown frameworks</li>
<li>"set_quotas": <a class="el" href="classSet.html">Set</a> quotas</li>
<li>"remove_quotas": Remove quotas</li>
<li>"reserve_resources": Reserve resources</li>
<li>"unreserve_resources": Unreserve resources</li>
<li>"create_volumes": Create persistent volumes</li>
<li>"destroy_volumes": Destroy persistent volumes</li>
</ol>
<p>The currently supported <code>Subjects</code> are:</p>
<ol type="1">
<li>"principals"<ul>
<li>Framework principals (used by "register_frameworks", "run_tasks", "reserve", "unreserve", "create_volumes", and "destroy_volumes" actions)</li>
<li>Usernames (used by "teardown_frameworks", "set_quotas", "remove_quotas", "reserve", "unreserve", "create_volumes", and "destroy_volumes" actions)</li>
</ul>
</li>
</ol>
<p>The currently supported <code>Objects</code> are:</p>
<ol type="1">
<li>"roles": Resource <a class="el" href="roles_8md.html">roles</a> that framework can register with (used by "register_frameworks" and "set_quotas" actions)</li>
<li>"users": Unix user to launch the task/executor as (used by "run_tasks" actions)</li>
<li>"framework_principals": Framework principals that can be torn down by HTTP POST (used by "teardown_frameworks" actions).</li>
<li>"resources": Resources that can be reserved. Currently the only types considered by the default authorizer are <code>ANY</code> and <code>NONE</code> (used by "reserves" action).</li>
<li>"reserver_principals": Framework principals whose reserved resources can be unreserved (used by "unreserves" action).</li>
<li>"volume_types": Types of volumes that can be created by a given principal. Currently the only types considered by the default authorizer are <code>ANY</code> and <code>NONE</code> (used by "create_volumes" action).</li>
<li>"creator_principals": Principals whose persistent volumes can be destroyed (used by "destroy_volumes" action).</li>
<li>"quota_principals": Principals that set the quota to be removed (used by "remove_quotas" action)</li>
</ol>
<blockquote class="doxtable">
<p>NOTE: Both <code>Subjects</code> and <code>Objects</code> can be either an array of strings or one of the special values <code>ANY</code> or <code>NONE</code>. </p>
</blockquote>
<h2>How does it work?</h2>
<p>The Mesos master checks the ACLs to verify whether a request is authorized or not.</p>
<p>For example, when a framework (re-)registers with the master, "register_frameworks" ACLs are checked to see if the framework (<code>FrameworkInfo.principal</code>) is authorized to receive offers for the given resource role (<code>FrameworkInfo.role</code>). If not authorized, the framework is not allowed to (re-)register and gets an <code><a class="el" href="classError.html">Error</a></code> message back (which aborts the scheduler driver).</p>
<p>Similarly, when a framework launches a task, "run_tasks" ACLs are checked to see if the framework (<code>FrameworkInfo.principal</code>) is authorized to run the task/executor as the given user. If not authorized, the launch is rejected and the framework gets a TASK_LOST.</p>
<p>In the same vein, when a user/principal attempts to teardown a framework using the "/teardown" HTTP endpoint on the master, "teardown_frameworks" ACLs are checked to see if the principal is authorized to teardown the given framework. If not authorized, the teardown is rejected and the user receives a <code>Forbidden</code> HTTP response.</p>
<p>If no user/principal is provided in a request to an HTTP endpoint and authentication is disabled, the <code>ANY</code> subject is used in the authorization.</p>
<p>There are couple of important things to note:</p>
<ol type="1">
<li>ACLs are matched in the order that they are specified. In other words, the first matching ACL determines whether a request is authorized or not.</li>
<li>If no ACLs match a request, whether the request is authorized or not is determined by the <code>ACLs.permissive</code> field. This is "true" by default &ndash; i.e., non-matching requests are authorized.</li>
</ol>
<h2>Examples</h2>
<ol type="1">
<li>Frameworks <code>foo</code> and <code>bar</code> can run tasks as user <code>alice</code>. <pre class="fragment"> {
   "run_tasks": [
                  {
                    "principals": { "values": ["foo", "bar"] },
                    "users": { "values": ["alice"] }
                  }
                ]
 }
</pre></li>
<li>Any framework can run tasks as user <code>guest</code>. <pre class="fragment"> {
   "run_tasks": [
                  {
                    "principals": { "type": "ANY" },
                    "users": { "values": ["guest"] }
                  }
                ]
 }
</pre></li>
<li>No framework can run tasks as <code>root</code>. <pre class="fragment"> {
   "run_tasks": [
                  {
                    "principals": { "type": "NONE" },
                    "users": { "values": ["root"] }
                  }
                ]
 }
</pre></li>
<li>Framework <code>foo</code> can run tasks only as user <code>guest</code> and no other user. <pre class="fragment"> {
   "run_tasks": [
                  {
                    "principals": { "values": ["foo"] },
                    "users": { "values": ["guest"] }
                  },
                  {
                    "principals": { "values": ["foo"] },
                    "users": { "type": "NONE" }
                  }
                ]
 }
</pre></li>
<li>Framework <code>foo</code> can register with the <code>analytics</code> and <code>ads</code> roles. <pre class="fragment"> {
   "register_frameworks": [
                            {
                              "principals": {
                                "values": ["foo"]
                              },
                              "roles": {
                                "values": ["analytics", "ads"]
                              }
                            }
                          ]
 }
</pre></li>
<li>Only framework <code>foo</code> and no one else can register with the <code>analytics</code> role. <pre class="fragment"> {
   "register_frameworks": [
                            {
                              "principals": {
                                "values": ["foo"]
                              },
                              "roles": {
                                "values": ["analytics"]
                              }
                            },
                            {
                              "principals": {
                                "type": "NONE"
                              },
                              "roles": {
                                "values": ["analytics"]
                              }
                            }
                          ]
 }
</pre></li>
<li>Framework <code>foo</code> can only register with the <code>analytics</code> role but no other roles. Also, no other framework can register with any roles or run tasks. <pre class="fragment"> {
   "permissive": false,
   "register_frameworks": [
                            {
                              "principals": {
                                "values": ["foo"]
                              },
                              "roles": {
                                "values": ["analytics"]
                              }
                            }
                          ]
 }
</pre></li>
<li>The <code>ops</code> principal can teardown any framework using the "/teardown" HTTP endpoint. No other framework can register with any roles or run tasks. <pre class="fragment"> {
   "permissive": false,
   "teardown_frameworks": [
                            {
                              "principals": {
                                "values": ["ops"]
                              },
                              "framework_principals": {
                                "type": "ANY"
                              }
                            }
                          ]
 }
</pre></li>
</ol>
<h2>Configuring authorization</h2>
<p>Authorization is configured by specifying the <code>--acls</code> flag when starting the master:</p>
<ul>
<li><code>acls</code>: The value could be a JSON-formatted string of ACLs or a file path containing the JSON-formatted ACLs used for authorization. <a class="el" href="classPath.html" title="Represents a POSIX file systems path and offers common path manipulations. ">Path</a> could be of the form '<a href="file:///path/to/file'">file:///path/to/file'</a> or '/path/to/file'. See the ACLs protobuf in authorizer.proto for the expected format.</li>
</ul>
<p>For more information on master command-line flags, see the <a class="el" href="configuration_8md.html">configuration</a> page. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
