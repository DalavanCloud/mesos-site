<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Apache Mesos: docker-containerizer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Apache Mesos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">docker-containerizer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>layout: documentation </h2>
<h1><a class="el" href="classDocker.html">Docker</a> Containerizer</h1>
<p>Mesos 0.20.0 adds the support for launching tasks that contains <a class="el" href="classDocker.html">Docker</a> images, with also a subset of <a class="el" href="classDocker.html">Docker</a> options supported while we plan on adding more in the future.</p>
<p>Users can either launch a <a class="el" href="classDocker.html">Docker</a> image as a Task, or as an Executor.</p>
<p>The following sections will describe the API changes along with <a class="el" href="classDocker.html">Docker</a> support, and also how to setup <a class="el" href="classDocker.html">Docker</a>.</p>
<h2>Setup</h2>
<p>To run the slave to enable the <a class="el" href="classDocker.html">Docker</a> Containerizer, you must launch the slave with "docker" as one of the containerizers option.</p>
<p>Example: <code>mesos-slave --containerizers=docker,mesos</code></p>
<p>Each slave that has the <a class="el" href="classDocker.html">Docker</a> containerizer should have <a class="el" href="classDocker.html">Docker</a> CLI client installed (version &gt;= 1.0.0).</p>
<p>If you enable iptables on slave, make sure the iptables allow all traffic from docker bridge interface through add below rule: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;iptables -A INPUT -s 172.17.0.0/16 -i docker0 -p tcp -j ACCEPT</div></div><!-- fragment --><h2>How do I use the <a class="el" href="classDocker.html">Docker</a> Containerizer?</h2>
<p>TaskInfo before 0.20.0 used to only support either setting a CommandInfo that launches a task running the bash command, or an ExecutorInfo that launches a custom Executor that will launches the task.</p>
<p>With 0.20.0 we added a ContainerInfo field to TaskInfo and ExecutorInfo that allows a Containerizer such as <a class="el" href="classDocker.html">Docker</a> to be configured to run the task or executor.</p>
<p>To run a <a class="el" href="classDocker.html">Docker</a> image as a task, in TaskInfo one must set both the command and the container field as the <a class="el" href="classDocker.html">Docker</a> Containerizer will use the accompanied command to launch the docker image. The ContainerInfo should have type <a class="el" href="classDocker.html">Docker</a> and a DockerInfo that has the desired docker image.</p>
<p>To run a <a class="el" href="classDocker.html">Docker</a> image as an executor, in TaskInfo one must set the ExecutorInfo that contains a ContainerInfo with type docker and the CommandInfo that will be used to launch the executor. Note that the <a class="el" href="classDocker.html">Docker</a> image is expected to launch up as a Mesos executor that will register with the slave once it launches.</p>
<h2>What does the <a class="el" href="classDocker.html">Docker</a> Containerizer do?</h2>
<p>The <a class="el" href="classDocker.html">Docker</a> Containerizer is translating Task/Executor <code>Launch</code> and <code>Destroy</code> calls to <a class="el" href="classDocker.html">Docker</a> CLI commands.</p>
<p>Currently the <a class="el" href="classDocker.html">Docker</a> Containerizer when launching as task will do the following:</p>
<ol type="1">
<li>Fetch all the files specified in the CommandInfo into the sandbox.</li>
<li>Pull the docker image from the remote repository.</li>
<li>Run the docker image with the <a class="el" href="classDocker.html">Docker</a> executor, and map the sandbox directory into the <a class="el" href="classDocker.html">Docker</a> container and set the directory mapping to the MESOS_SANDBOX environment variable. The executor will also stream the container logs into stdout/stderr files in the sandbox.</li>
<li>On container exit or containerizer destroy, stop and remove the docker container.</li>
</ol>
<p>The <a class="el" href="classDocker.html">Docker</a> Containerizer launches all containers with the <code>mesos-</code> prefix plus the slave id (ie: <code>mesos-slave1-abcdefghji</code>), and also assumes all containers with the <code>mesos-</code> prefix is managed by the slave and is free to stop or kill the containers.</p>
<p>When launching the docker image as an Executor, the only difference is that it skips launching a command executor but just reaps on the docker container executor pid.</p>
<p>Note that we currently default to host networking when running a docker image, to easier support running a docker image as an Executor.</p>
<p>The containerizer also supports optional force pulling of the image. It is set disabled as default, so the docker image will only be updated again if it's not available on the host. To enable force pulling an image, <code>force_pull_image</code> has to be set as true.</p>
<h2>Private <a class="el" href="classDocker.html">Docker</a> repository</h2>
<p>To run an image from a private repository, one can include the uri pointing to a <code>.dockercfg</code> that contains login information. The <code>.dockercfg</code> file will be pulled into the sandbox the <a class="el" href="classDocker.html">Docker</a> Containerizer set the HOME environment variable pointing to the sandbox so docker cli will automatically pick up the config file.</p>
<h2>CommandInfo to run <a class="el" href="classDocker.html">Docker</a> images</h2>
<p>A docker image currently supports having an entrypoint and/or a default command.</p>
<p>To run a docker image with the default command (ie: <code>docker run image</code>), the CommandInfo's value must not be set. If the value is set then it will override the default command.</p>
<p>To run a docker image with an entrypoint defined, the CommandInfo's shell option must be set to false. If shell option is set to true the <a class="el" href="classDocker.html">Docker</a> Containerizer will run the user's command wrapped with <code>/bin/sh -c</code> which will also become parameters to the image entrypoint.</p>
<h2>Recover <a class="el" href="classDocker.html">Docker</a> containers on slave recovery</h2>
<p>The <a class="el" href="classDocker.html">Docker</a> containerizer supports recovering <a class="el" href="classDocker.html">Docker</a> containers when the slave restarts, which supports both when the slave is running in a <a class="el" href="classDocker.html">Docker</a> container or not.</p>
<p>With the <code>--docker_mesos_image</code> flag enabled, the <a class="el" href="classDocker.html">Docker</a> containerizer assumes the containerizer is running in a container itself and modifies the mechanism it recovers and launches docker containers accordingly. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
